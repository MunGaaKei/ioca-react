import{jsxs as r,Fragment as t,jsx as e}from"react/jsx-runtime";import{useMouseUp as o,useResizeObserver as n}from"../../js/hooks.js";import{getPointPosition as s,getPosition as c}from"../../js/utils.js";import{useReactive as i,useCreation as u}from"ahooks";import{useRef as a,useMemo as l,useEffect as f,useLayoutEffect as p,Children as h,isValidElement as w,cloneElement as m}from"react";import g from"./content.js";function y(y){const{visible:d=!1,content:v,trigger:b="hover",gap:x=12,offset:j=8,fixed:P,position:k="top",showDelay:T=16,hideDelay:C=12,touchable:M,arrow:N=!0,align:W,fitSize:D,watchResize:O,clickOutside:z=!0,disabled:E,referToWindow:L,style:X,className:Y,getContainer:B,children:F,onVisibleChange:H}=y,R=a(null),S=a(null),V=a(null),q=a(""),A=i({show:!1,style:{position:P?"fixed":"absolute"},arrowProps:{}});o((r=>{if(!R.current||!S.current||!z)return;const t=r.target,e=R.current.contains(t)||S.current.contains(t);A.show&&!e&&K(!1)}));const G=()=>{V.current&&(clearTimeout(V.current),V.current=null)},I=()=>{E||A.show&&("hover"!==b||"hover"===b&&!M)||(A.show=!0,q.current="showing",V.current=setTimeout((()=>{if("showing"!==q.current)return;const[r,t,{arrowX:e,arrowY:o,arrowPos:n}]=c(R.current,S.current,{position:k,gap:x,offset:j,align:W,refWindow:L});A.style={...A.style,opacity:1,transform:"none",left:r,top:t},A.arrowProps={left:e,top:o,pos:n},H?.(!0),G(),q.current=""}),T))},J=()=>{A.show&&(q.current="hiding",V.current=setTimeout((()=>{"hiding"===q.current?(A.style={...A.style,opacity:0,transform:"translate(0, 2px)"},setTimeout((()=>{A.show=!1,G(),H?.(!1),q.current=""}),160)):G()}),C))},K=r=>{void 0===r?A.show?J():I():r?I():J()},Q=u((()=>({click:{onClick:()=>K(!0)},hover:{onMouseEnter:()=>K(!0),onMouseLeave:()=>K(!1)},focus:{onFocus:()=>K(!0),onBlur:()=>K(!1)},contextmenu:{onContextMenu:r=>{if(r.preventDefault(),r.stopPropagation(),A.show){const[t,e]=s(r,S.current);A.style={...A.style,left:t,top:e}}else A.show=!0,V.current=setTimeout((()=>{const[t,e]=s(r,S.current);A.style={...A.style,opacity:1,transform:"none",left:t,top:e},G(),H?.(!0)}),T)}},none:{}})),[]),U=l((()=>{if(!M)return{};const r={};return"hover"===b&&(r.onMouseEnter=()=>{G()},r.onMouseLeave=()=>K(!1)),r}),[M,b]),Z=()=>{if(!A.show)return;const[r,t,{arrowX:e,arrowY:o,arrowPos:n}]=c(R.current,S.current,{position:k,gap:x,offset:j,align:W,refWindow:L});Object.assign(A,{style:{...A.style,left:r,top:t},arrowProps:{left:e,top:o,pos:n}})};return f((()=>{if("contextmenu"===b)return;const{observe:r,unobserve:t,disconnect:e}=n();return R.current&&r(R.current,Z),O&&S.current?(r(S.current,Z),()=>{O&&S.current&&(t(S.current),R.current&&t(R.current),e())}):void 0}),[O,S.current,R.current]),p((()=>{if(!D||!A.show)return;const r=["top","bottom"].includes(k),t=R.current?.[r?"offsetWidth":"offsetHeight"];A.style={...A.style,[r?"width":"height"]:t}}),[A.show,D]),p((()=>{K(d)}),[d]),r(t,{children:[h.map(F,(r=>{if(!w(r))return;const{className:t,...e}=r.props;return Object.keys(Q[b]).map((r=>{if(!e[r])return;const t=Q[b][r];Q[b][r]=o=>{t(),e[r](o)}})),m(r,{ref:R,className:t,...e,...Q[b]})})),A.show&&e(g,{ref:S,arrow:N&&"contextmenu"!==b,style:{...X,...A.style},arrowProps:A.arrowProps,className:Y,...U,trigger:R.current,getContainer:B,children:v})]})}export{y as default};
//# sourceMappingURL=popup.js.map
