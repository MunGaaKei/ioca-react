{"version":3,"file":"editor.js","sources":["../../../packages/components/editor/editor.tsx"],"sourcesContent":["import classNames from \"classnames\";\nimport { useImperativeHandle, useRef } from \"react\";\nimport xss from \"xss\";\nimport { IButton } from \"../button/type\";\nimport getControls, { exec, xssOptions } from \"./controls\";\nimport \"./index.css\";\nimport { IEditor } from \"./type\";\n\nconst Editor = (props: IEditor) => {\n\tconst {\n\t\tref,\n\t\twidth,\n\t\theight = \"10em\",\n\t\tplaceholder,\n\t\tautosize,\n\t\tborder = true,\n\t\trichPaste,\n\t\tcontrols = \"simple\",\n\t\tclassName,\n\t\tstyle,\n\t\tonInput,\n\t\tonPaste,\n\t\tonKeyDown,\n\t\t...restProps\n\t} = props;\n\tconst editorRef = useRef<HTMLDivElement>(null);\n\tconst controlBtnProps: IButton = {\n\t\tsquare: true,\n\t\tflat: true,\n\t\tsize: \"small\",\n\t};\n\n\tconst handlePaste = async (e) => {\n\t\tonPaste?.(e);\n\n\t\tif (richPaste) return;\n\t\te.preventDefault();\n\t\tconst text = e.clipboardData.getData(\"text/plain\");\n\t\texec(\"insertText\", false, text);\n\t};\n\n\tconst handleKeyDown = (e) => {\n\t\tonKeyDown?.(e);\n\n\t\tswitch (e.key) {\n\t\t\tcase \"Tab\":\n\t\t\t\te.preventDefault();\n\t\t\t\texec(\"insertHTML\", false, \"&#09;\");\n\t\t\t\tbreak;\n\t\t\tcase \"Enter\":\n\t\t\t\te.preventDefault();\n\t\t\t\texec(\"insertLineBreak\");\n\n\t\t\t\tif (!editorRef.current) return;\n\t\t\t\teditorRef.current.scrollBy({\n\t\t\t\t\ttop: 20,\n\t\t\t\t\tleft: -1000,\n\t\t\t\t});\n\n\t\t\t\tif (!autosize) return;\n\t\t\t\teditorRef.current.style.height = `${editorRef.current.scrollHeight}px`;\n\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\tuseImperativeHandle(ref, () => {\n\t\treturn {\n\t\t\tsetValue(html) {\n\t\t\t\tif (!editorRef.current) return;\n\t\t\t\tconst safeHtml = xss(html, xssOptions);\n\n\t\t\t\teditorRef.current.innerHTML = safeHtml;\n\t\t\t},\n\t\t\tgetSafeValue() {\n\t\t\t\tconst html = editorRef.current?.innerHTML ?? \"\";\n\n\t\t\t\treturn xss(html, xssOptions);\n\t\t\t},\n\t\t};\n\t});\n\n\tconst handleInput = (e) => {\n\t\tlet html = editorRef.current?.innerHTML ?? \"\";\n\n\t\tif ([\"<br>\", \"\\n\"].includes(html) && editorRef.current) {\n\t\t\thtml = \"\";\n\t\t\teditorRef.current.innerHTML = html;\n\t\t}\n\n\t\tonInput?.(html, e);\n\t};\n\n\treturn (\n\t\t<div\n\t\t\tclassName={classNames(\"i-editor\", className, {\n\t\t\t\t\"i-editor-borderless\": !border,\n\t\t\t})}\n\t\t\tstyle={{\n\t\t\t\t...style,\n\t\t\t\t[autosize ? \"minHeight\" : \"height\"]: height,\n\t\t\t\twidth,\n\t\t\t}}\n\t\t>\n\t\t\t{controls !== \"none\" && (\n\t\t\t\t<div className='i-editor-controls'>\n\t\t\t\t\t{getControls(controls, {\n\t\t\t\t\t\tcontrolBtnProps,\n\t\t\t\t\t})}\n\t\t\t\t</div>\n\t\t\t)}\n\n\t\t\t<div\n\t\t\t\tref={editorRef}\n\t\t\t\tclassName='i-editor-content'\n\t\t\t\tdata-placeholder={placeholder}\n\t\t\t\tcontentEditable\n\t\t\t\tonPaste={handlePaste}\n\t\t\t\tonInput={handleInput}\n\t\t\t\tonKeyDown={handleKeyDown}\n\t\t\t\t{...restProps}\n\t\t\t/>\n\t\t</div>\n\t);\n};\n\nexport default Editor;\n"],"names":["Editor","props","ref","width","height","placeholder","autosize","border","richPaste","controls","className","style","onInput","onPaste","onKeyDown","restProps","editorRef","useRef","useImperativeHandle","setValue","html","current","safeHtml","xss","xssOptions","innerHTML","getSafeValue","_jsxs","classNames","children","_jsx","getControls","controlBtnProps","square","flat","size","contentEditable","async","e","preventDefault","text","clipboardData","getData","exec","includes","key","scrollBy","top","left","scrollHeight"],"mappings":"+MAQA,MAAMA,EAAUC,IACf,MAAMC,IACLA,EAAGC,MACHA,EAAKC,OACLA,EAAS,OAAMC,YACfA,EAAWC,SACXA,EAAQC,OACRA,GAAS,EAAIC,UACbA,EAASC,SACTA,EAAW,SAAQC,UACnBA,EAASC,MACTA,EAAKC,QACLA,EAAOC,QACPA,EAAOC,UACPA,KACGC,GACAd,EACEe,EAAYC,EAAuB,MA2CzCC,EAAoBhB,GAAK,KACjB,CACN,QAAAiB,CAASC,GACR,IAAKJ,EAAUK,QAAS,OACxB,MAAMC,EAAWC,EAAIH,EAAMI,GAE3BR,EAAUK,QAAQI,UAAYH,CAC9B,EACD,YAAAI,GACC,MAAMN,EAAOJ,EAAUK,SAASI,WAAa,GAE7C,OAAOF,EAAIH,EAAMI,EACjB,MAeH,OACCG,SACCjB,UAAWkB,EAAW,WAAYlB,EAAW,CAC5C,uBAAwBH,IAEzBI,MAAO,IACHA,EACH,CAACL,EAAW,YAAc,UAAWF,EACrCD,SACA0B,SAAA,CAEa,SAAbpB,GACAqB,EAAA,MAAA,CAAKpB,UAAU,oBAAmBmB,SAChCE,EAAYtB,EAAU,CACtBuB,gBAnF4B,CAChCC,QAAQ,EACRC,MAAM,EACNC,KAAM,aAqFLL,EAAA,MAAA,CACC5B,IAAKc,EACLN,UAAU,mBACQ,mBAAAL,EAClB+B,iBAAe,EACfvB,QAvFiBwB,MAAOC,IAG1B,GAFAzB,IAAUyB,GAEN9B,EAAW,OACf8B,EAAEC,iBACF,MAAMC,EAAOF,EAAEG,cAAcC,QAAQ,cACrCC,EAAK,cAAc,EAAOH,EAAK,EAkF7B5B,QApCkB0B,IACpB,IAAIlB,EAAOJ,EAAUK,SAASI,WAAa,GAEvC,CAAC,OAAQ,MAAMmB,SAASxB,IAASJ,EAAUK,UAC9CD,EAAO,GACPJ,EAAUK,QAAQI,UAAYL,GAG/BR,IAAUQ,EAAMkB,EAAE,EA6BhBxB,UAhFoBwB,IAGtB,OAFAxB,IAAYwB,GAEJA,EAAEO,KACT,IAAK,MACJP,EAAEC,iBACFI,EAAK,cAAc,EAAO,SAC1B,MACD,IAAK,QAIJ,GAHAL,EAAEC,iBACFI,EAAK,oBAEA3B,EAAUK,QAAS,OAMxB,GALAL,EAAUK,QAAQyB,SAAS,CAC1BC,IAAK,GACLC,MAAW,OAGP1C,EAAU,OACfU,EAAUK,QAAQV,MAAMP,OAAS,GAAGY,EAAUK,QAAQ4B,sBA8DlDlC,MAEA"}