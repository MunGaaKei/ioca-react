import{jsx as e,jsxs as r,Fragment as t}from"react/jsx-runtime";import{KeyboardArrowLeftRound as i,KeyboardArrowRightRound as n}from"@ricons/material";import{useReactive as s}from"ahooks";import a from"classnames";import{useRef as o,useMemo as c,Children as l,useImperativeHandle as u,useEffect as d}from"react";import{useMouseMove as m,useMouseUp as p}from"../../js/hooks.js";import{clamp as f}from"../../js/utils.js";import g from"../icon/icon.js";import h from"./item.js";const w=w=>{const{ref:v,type:T="normal",initial:y=0,display:b=1,scroll:j=1,loop:x=!0,vertical:N,prev:k=e(g,{icon:e(i,{}),size:"2em"}),next:M=e(g,{icon:e(n,{}),size:"2em"}),duration:S=600,interval:$=3e3,autoplay:I,pauseOnHover:z,arrow:C=!0,reverse:H,draggable:O,dragOffset:D=40,gap:X=0,itemHeight:Y,indicator:A,fixedIndicator:P,style:W,className:B,children:L,renderIndicator:q,onBeforeSwipe:E,onAfterSwipe:F,onItemClick:G}=w,J=o(null),K=o(null),Q=`all ${S/1e3}s`,R=s({current:y,swipable:!0,transition:"fade"===T?"none":Q,dragStart:0,dragging:!1,initialized:!1}),U=c((()=>l.map(L,(e=>{if(e.type===h)return e}))),[L]),[V,Z,_,ee,re]=c((()=>{const e="normal"===T&&x&&U.length>b?b+1:0;let r=[];if(e<=0)r=[...U];else{const t=U.slice(0,e);r=[...U.slice(-e),...U,...t]}const t=r.length/b*100+"%";return[r,e,U.length,r.length,t]}),[b,x,T,U]),te=c((()=>-100*(R.current+Z)/ee),[R.current,ee]),ie=c((()=>{if(_<=b||"fade"===T)return;return`translate3d(${N?`0, ${te}%`:`${te}%, 0`}, 0)`}),[te,N,b,_,T]),ne=c((()=>{if(N&&Y)return{height:Y*b}}),[N,Y,b]),se=c((()=>Array.from({length:Math.ceil((_-b)/j)+1})),[x,A]),ae=()=>{clearTimeout(K.current),K.current=null},oe=e=>{if(!R.swipable||e===R.current)return;R.swipable=!1,E?.(R.current);let r=!1,t=e;const i=_-b;return x?e>i?(r=!0,e=_,t=0):e<0&&(r=!0,e=-b,t=i):(t=f(t,0,i),e=t),setTimeout((()=>{R.swipable=!0}),S+32),"fade"===T?(R.current=t,void F?.(t)):(R.current=e,r?void setTimeout((()=>{R.transition="none",R.current=t,F?.(t),I&&(K.current=setTimeout(ce,$)),setTimeout((()=>{R.transition=Q}),60)}),S+20):(I&&(K.current=setTimeout(ce,$)),void setTimeout((()=>{F?.(t)}),S+12)))},ce=()=>{oe(H?R.current-j:R.current+j)},le=()=>{oe(H?R.current+j:R.current-j)},ue=e=>{O&&R.swipable&&"fade"!==T&&(e.stopPropagation(),e.preventDefault(),e.touches&&(e=e.touches[0]),Object.assign(R,{dragStart:N?e.clientY:e.clientX,dragging:!0,transition:"none"}))};return m((e=>{if(!R.dragging||!J.current)return;e.preventDefault(),e.touches&&(e=e.touches[0]);const r=61.8*((N?e.clientY:e.clientX)-R.dragStart)/J.current[N?"offsetHeight":"offsetWidth"]+te;J.current.style.transform=`translate3d(${N?`0, ${r}%`:`${r}%, 0`}, 0)`})),p((e=>{if(!R.dragging||!J.current)return;e.changedTouches&&(e=e.changedTouches[0]);const r=N?e.clientY:e.clientX,t=J.current[N?"offsetHeight":"offsetWidth"]/ee,i=.618*(r-R.dragStart),n=Math.abs(i);if(n>D){const e=Math.floor(n/t)+(n%t-D>0?1:0);let r=R.current+(i>0?-e:e);oe(r)}J.current.style.transform=ie||"",Object.assign(R,{dragging:!1,transition:Q})})),u(v,(()=>({swipeTo:oe,swipeNext:ce,swipePrev:le}))),d((()=>{if(I)return K.current=setTimeout(ce,$),()=>{clearTimeout(K.current),K.current=null}}),[I,$]),r("div",{style:W,className:a("i-swiper",{"i-swiper-vertical":N,"i-swiper-initialized":R.initialized},B),children:[r("div",{className:"i-swiper-track",style:ne,onMouseOver:()=>{z&&ae()},onMouseLeave:()=>{z&&(ae(),K.current=setTimeout(ce,$))},children:[e("div",{ref:J,className:a("i-swiper-list",{"i-swiper-fade":"fade"===T}),style:{[N?"height":"width"]:re,transform:ie,transition:R.transition},onMouseDown:ue,onTouchStart:ue,children:V.map(((r,t)=>{const{props:i}=r;return e(h,{index:t,itemIndex:(t-Z+_)%_,active:t-Z===R.current,type:T,gap:X,transition:Q,itemHeight:Y,vertical:N,onItemClick:G,...i},t)}))}),C&&r(t,{children:[(x||0!==R.current)&&e("a",{className:"i-swiper-arrow i-swiper-prev",onClick:le,children:k}),(x||R.current<_-b)&&e("a",{className:"i-swiper-arrow i-swiper-next",onClick:ce,children:M})]})]}),A&&e("div",{className:a("i-swiper-indicators",{"i-swiper-indicators-fixed":P}),children:se.map(((r,t)=>e("a",{className:a("i-swiper-indicator",{"i-indicator-active":t===Math[x?"floor":"ceil"]((R.current+_)%_/j)}),onClick:()=>oe(t*j),children:q?.(t)},t)))})]})};w.Item=h;export{w as default};
//# sourceMappingURL=swiper.js.map
