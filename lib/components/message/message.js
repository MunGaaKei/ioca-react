import{jsx as e,jsxs as t,Fragment as n}from"react/jsx-runtime";import{useReactive as s}from"ahooks";import i from"classnames";import{uid as c}from"radash";import{useRef as o,useEffect as r,isValidElement as a}from"react";import{createRoot as l}from"react-dom/client";const m={left:"flex-start",center:"center",right:"flex-end"},u=12,d={duration:3e3,closable:!0,active:!1},f=function(){const e=document.createElement("div");return e.dataset.id="messages",document.body.append(e),e}(),g={oneInstance:null,callout(e){},close(){}},p={left:[],center:[],right:[]},h={left:[],center:[],right:[]};l(f).render(e((function(){const i=o(null),c=s({items:{left:[],center:[],right:[]},tops:{left:[],center:[],right:[]}}),a={left:0,center:0,right:0};r((()=>{Object.assign(g,{callout:function(e){const{align:t="center",unshift:n,onShow:s}=e,o=p[t][n?"unshift":"push"](e);c.items[t]=[...p[t]],e.close=this.close.bind(e),setTimeout((()=>{const e=i.current?.offsetHeight||0;p[t][n?0:o-1].active=!0,c.items[t]=[...p[t]],h[t][n?"unshift":"push"](e),c.tops[t]=[...h[t]],s?.()}),12),0!==e.duration&&(e.timer=setTimeout((()=>{this.close.call(e)}),e.duration))},close:function(){const e=this,{align:t="center",onHide:n}=e,s=p[t].findIndex((t=>t.id===e.id));s<0||(p[t][s].active=!1,c.items[t]=[...p[t]],e.timer=setTimeout((()=>{const s=p[t].findIndex((t=>t.id===e.id));p[t].splice(s,1),h[t].splice(s,1),c.tops[t]=[...h[t]],c.items[t]=[...p[t]],e.timer&&clearTimeout(e.timer),n?.()}),240))}})}),[]);const l=(t,s)=>{if(!t)return e(n,{});const{id:o,active:r,content:l,align:d="center",className:f}=t;a[d]+=c.tops[d][s-1]||0;const p=u*s+a[d];return e(b,{ref:i,active:r,content:l,top:p,className:f,style:{alignSelf:m[d]},onClick:g.close.bind(t)},o)};return t("div",{className:"i-messages",children:[c.items.left.map(l),c.items.center.map(l),c.items.right.map(l)]})}),{}));const b=function({ref:t,active:n,content:s,top:c,className:o,style:r,onClick:a}){return e("div",{ref:t,className:i("i-message",o,{"i-message-active":n}),style:{...r,top:c},onClick:a,children:s})};function v(e){return(["string","number"].includes(typeof e)||a(e))&&(e={content:e}),e=Object.assign({id:c(7)},d,e),g.callout(e),{instance:e,close:g.close.bind(e)}}v.error=e=>v({content:e,className:"bg-error"}),v.success=e=>v({content:e,className:"bg-success"}),v.warning=e=>v({content:e,className:"bg-warning"}),v.one=e=>{const t=g.oneInstance;if(t)t.active&&0!==t.duration?(clearTimeout(t.timer),t.timer=setTimeout((()=>{t.close?.()}),t.duration)):g.callout(t);else{const{instance:t}=v(e);g.oneInstance=t}};export{v as default};
//# sourceMappingURL=message.js.map
