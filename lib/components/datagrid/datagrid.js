import{jsx as e,jsxs as t}from"react/jsx-runtime";import{useReactive as r}from"ahooks";import o from"classnames";import{useRef as i,useMemo as s,useEffect as l}from"react";import{getNextSorter as n}from"../../js/utils.js";import a from"../loading/loading.js";import d from"../utils/empty/index.js";import c,{Header as m}from"./row.js";const p=p=>{const{data:f=[],columns:u=[],border:g,striped:h,header:y=!0,resizable:w,cellPadding:C=".5em",cellEllipsis:j,empty:x=e(d,{}),loading:T,height:k="unset",style:B,className:b,renderLoading:z=()=>e(a,{size:"1.5em",className:"color-3"}),onCellClick:N,onRowClick:$,onHeaderClick:v,onSort:E,onScroll:H,onResize:R}=p,S=i(null),W=r({rows:f,widths:u.map((e=>e.width??"min-content")),sortBy:"",sortType:""}),q=s((()=>{const{widths:e}=W,t={...B,"--grid-template-columns":e.map((e=>"number"==typeof e?`${e}px`:e)).join(" ")};if(!w)return t;const r=u.map(((t,r)=>{const{fixed:o}=t;return o?e[r]:0}));return u.map(((e,o)=>{const{fixed:i}=e;if(i)if(0===o)t["--datagrid-cell-inset-0"]=0;else if(o===r.length-1)t["--datagrid-cell-inset-"+(r.length-1)]="auto 0";else{const e="left"===i,s=(e?r.slice(0,o):r.slice(o+1)).reduce(((e,t)=>e+t))+"px",l=e?`${s} auto`:`auto ${s}`;t[`--datagrid-cell-inset-${o}`]=l}})),t}),[W.widths,w]),A=s((()=>{const{sortBy:e,sortType:t}=W;if(e&&!E){const r=u.find((t=>t.id===e))?.sorter,o="function"==typeof r?r:(t,r)=>r[e]-t[e],i=[...f].sort(o);return"desc"===t?i:i.reverse()}return f}),[f,u,W.sortBy,W.sortType]);l((()=>{if(!S.current)return;const{current:e}=S,t=e.querySelector(".i-datagrid-row")?.children;t?.length&&(W.widths=Array.from(t).map((e=>e.offsetWidth)))}),[u,w]),l((()=>{T&&S.current?.scrollTo({top:0,left:0})}),[T]);const L={"--cell-padding":C,...q};return t("div",{style:{maxHeight:k,...L},className:o("i-datagrid-container",b,{"i-datagrid-bordered":g,"i-datagrid-striped":h}),children:[t("div",{ref:S,className:o("i-datagrid",{"i-datagrid-loading":T}),onWheel:H,children:[y&&e(m,{columns:u,resizable:w,sortType:W.sortType,sortBy:W.sortBy,cellEllipsis:j,onWidthChange:(e,t)=>{if(!w)return;const[...r]=W.widths;r[e]=t,W.widths=r,R?.(u[e],t)},onHeaderClick:(e,t)=>{if(e?.sorter){const[t,r]=n(W.sortBy,W.sortType,e.id);Object.assign(W,{sortBy:t,sortType:r}),E?.(t,r)}v?.(e,t)}}),A.map(((t,r)=>e(c,{row:r+(y?1:0),data:t,cellEllipsis:j,columns:u,onCellClick:N,onRowClick:$},r))),A.length<1&&x]}),T&&z()]})};export{p as default};
//# sourceMappingURL=datagrid.js.map
