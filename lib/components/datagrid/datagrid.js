import{jsx as e,jsxs as r}from"react/jsx-runtime";import{getNextSorter as t}from"../../js/utils.js";import{useReactive as o}from"ahooks";import i from"classnames";import{useRef as s,useMemo as l,useEffect as n}from"react";import a from"react-custom-scrollbars-2";import d from"../loading/loading.js";import c from"../utils/empty/index.js";import m,{Header as p}from"./row.js";const u=u=>{const{data:f=[],columns:g=[],border:h,striped:y,header:w=!0,resizable:C,cellPadding:j=".5em",cellEllipsis:x,empty:T=e(c,{}),loading:b,height:k="unset",style:B,className:H,renderLoading:N=()=>e(d,{size:"1.5em",className:"color-3"}),onCellClick:z,onRowClick:S,onHeaderClick:$,onSort:v,onScroll:E,onResize:R}=u,W=s(null),q=s(null),A=o({rows:f,widths:g.map((e=>e.width??"min-content")),sortBy:"",sortType:""}),L=l((()=>{const{widths:e}=A,r={...B,"--grid-template-columns":e.map((e=>"number"==typeof e?`${e}px`:e)).join(" ")};if(!C)return r;const t=g.map(((r,t)=>{const{fixed:o}=r;return o?e[t]:0}));return g.map(((e,o)=>{const{fixed:i}=e;if(i)if(0===o)r["--datagrid-cell-inset-0"]=0;else if(o===t.length-1)r["--datagrid-cell-inset-"+(t.length-1)]="auto 0";else{const e="left"===i,s=(e?t.slice(0,o):t.slice(o+1)).reduce(((e,r)=>e+r))+"px",l=e?`${s} auto`:`auto ${s}`;r[`--datagrid-cell-inset-${o}`]=l}})),r}),[A.widths,C]),M=l((()=>{const{sortBy:e,sortType:r}=A;if(e&&!v){const t=g.find((r=>r.id===e))?.sorter,o="function"==typeof t?t:(r,t)=>t[e]-r[e],i=[...f].sort(o);return"desc"===r?i:i.reverse()}return f}),[f,g,A.sortBy,A.sortType]);n((()=>{if(!W.current)return;const{current:e}=W,r=e.querySelector(".i-datagrid-row")?.children;r?.length&&(A.widths=Array.from(r).map((e=>e.offsetWidth)))}),[g,C]),n((()=>{b&&q.current?.scrollTop(0)}),[b]);const O={"--cell-padding":j,...L};return r(a,{ref:q,autoHide:!0,autoHeight:!0,autoHeightMax:k,style:O,className:i("i-datagrid-container",H,{"i-datagrid-bordered":h,"i-datagrid-striped":y}),renderView:r=>e("div",{...r,className:i({"i-datagrid-loading":b})}),onScroll:E,children:[r("div",{ref:W,className:"i-datagrid",children:[w&&e(p,{columns:g,resizable:C,sortType:A.sortType,sortBy:A.sortBy,cellEllipsis:x,onWidthChange:(e,r)=>{if(!C)return;const[...t]=A.widths;t[e]=r,A.widths=t,R?.(g[e],r)},onHeaderClick:(e,r)=>{if(e?.sorter){const[r,o]=t(A.sortBy,A.sortType,e.id);Object.assign(A,{sortBy:r,sortType:o}),v?.(r,o)}$?.(e,r)}}),M.map(((r,t)=>e(m,{row:t+(w?1:0),data:r,cellEllipsis:x,columns:g,onCellClick:z,onRowClick:S},t))),M.length<1&&T]}),b&&N()]})};export{u as default};
//# sourceMappingURL=datagrid.js.map
