{"version":3,"file":"select.js","sources":["../../../packages/components/select/select.tsx"],"sourcesContent":["import { UnfoldMoreRound } from \"@ricons/material\";\nimport { useReactive } from \"ahooks\";\nimport classNames from \"classnames\";\nimport { debounce } from \"radash\";\nimport { ChangeEvent, useEffect, useMemo, useState } from \"react\";\nimport \"../../css/input.css\";\nimport { formatOption } from \"../../js/utils\";\nimport { TOption } from \"../../type\";\nimport Popup from \"../popup\";\nimport Helpericon from \"../utils/helpericon\";\nimport \"./index.css\";\nimport { Options, displayValue } from \"./options\";\nimport { ISelect } from \"./type\";\n\nconst Select = (props: ISelect) => {\n\tconst {\n\t\tref,\n\t\ttype = \"text\",\n\t\tname,\n\t\tlabel,\n\t\tvalue = \"\",\n\t\tplaceholder,\n\t\toptions = [],\n\t\tmultiple,\n\t\tprepend,\n\t\tappend,\n\t\tlabelInline,\n\t\tstyle,\n\t\tclassName,\n\t\tmessage,\n\t\tstatus = \"normal\",\n\t\thideClear,\n\t\thideArrow,\n\t\tmaxDisplay,\n\t\tborder,\n\t\tfilter,\n\t\ttip,\n\t\tfilterPlaceholder = \"...\",\n\t\tpopupProps,\n\t\tonSelect,\n\t\tonChange,\n\t\t...restProps\n\t} = props;\n\n\tconst state = useReactive({\n\t\tinputValue: \"\",\n\t\tfilterValue: \"\",\n\t\tvalue,\n\t\tloading: false,\n\t});\n\n\tconst [active, setActive] = useState<boolean>(false);\n\n\tconst formattedOptions = useMemo(() => formatOption(options), [options]);\n\n\tconst filterOptions = useMemo(() => {\n\t\tconst { filterValue: fv } = state;\n\t\tif (!fv || !filter) return formattedOptions;\n\n\t\tconst filterFn =\n\t\t\ttypeof filter === \"function\"\n\t\t\t\t? filter\n\t\t\t\t: (opt) => opt.value.includes(fv) || opt.label.includes(fv);\n\n\t\treturn formattedOptions.filter(filterFn);\n\t}, [formattedOptions, filter, state.filterValue]);\n\n\tconst changeValue = (v: any) => {\n\t\tstate.value = v;\n\t\tonChange?.(v);\n\t};\n\n\tconst handleSelect = (value: any, option?: TOption) => {\n\t\tonSelect?.(value, option);\n\n\t\tif (multiple) {\n\t\t\tconst values = [...(state.value as any[])];\n\t\t\tconst i = values.findIndex((v) => v === value);\n\n\t\t\ti > -1 ? values.splice(i, 1) : values.push(value);\n\t\t\tchangeValue(values as any);\n\n\t\t\treturn;\n\t\t}\n\n\t\tsetActive(false);\n\t\tchangeValue(value);\n\t};\n\n\tconst handleVisibleChange = (visible: boolean) => {\n\t\tsetActive(visible);\n\n\t\tif (!filter) return;\n\n\t\tstate.filterValue = \"\";\n\t};\n\n\tconst handleHelperClick = (e) => {\n\t\te.stopPropagation();\n\t\tsetActive(true);\n\t\tif (!active) return;\n\n\t\tchangeValue(multiple ? [] : \"\");\n\t};\n\n\tconst handleFilterChange = debounce(\n\t\t{ delay: 400 },\n\t\t(e: ChangeEvent<HTMLInputElement>) => {\n\t\t\tconst v = e.target.value;\n\t\t\tstate.filterValue = v;\n\t\t}\n\t);\n\n\tconst handleInputChange = (e: ChangeEvent<HTMLInputElement>) => {\n\t\tstate.filterValue = e.target.value;\n\t};\n\n\tuseEffect(() => {\n\t\tstate.value = value;\n\t}, [value]);\n\n\tconst hasValue = multiple\n\t\t? (state.value as any[]).length > 0\n\t\t: !!state.value;\n\tconst clearable = !hideClear && active && hasValue;\n\tconst text = message ?? tip;\n\n\treturn (\n\t\t<label\n\t\t\tclassName={classNames(\"i-input-label\", className, {\n\t\t\t\t\"i-input-inline\": labelInline,\n\t\t\t})}\n\t\t\tstyle={style}\n\t\t>\n\t\t\t{label && <span className='i-input-label-text'>{label}</span>}\n\n\t\t\t<Popup\n\t\t\t\tposition='bottom'\n\t\t\t\tarrow={false}\n\t\t\t\tfitSize\n\t\t\t\t{...popupProps}\n\t\t\t\tvisible={active}\n\t\t\t\ttrigger='none'\n\t\t\t\tonVisibleChange={handleVisibleChange}\n\t\t\t\tcontent={\n\t\t\t\t\t<Options\n\t\t\t\t\t\toptions={filterOptions}\n\t\t\t\t\t\tvalue={state.value}\n\t\t\t\t\t\tmultiple={multiple}\n\t\t\t\t\t\tfilter={!!filter}\n\t\t\t\t\t\tfilterPlaceholder={filterPlaceholder}\n\t\t\t\t\t\tonSelect={handleSelect}\n\t\t\t\t\t\tonFilter={handleFilterChange}\n\t\t\t\t\t/>\n\t\t\t\t}\n\t\t\t>\n\t\t\t\t<div\n\t\t\t\t\tclassName={classNames(\"i-input-item\", {\n\t\t\t\t\t\t[`i-input-${status}`]: status !== \"normal\",\n\t\t\t\t\t\t\"i-input-borderless\": !border,\n\t\t\t\t\t\t\"i-input-focus\": active,\n\t\t\t\t\t})}\n\t\t\t\t\tonClick={() => setActive(true)}\n\t\t\t\t>\n\t\t\t\t\t{prepend}\n\n\t\t\t\t\t<input\n\t\t\t\t\t\tref={ref}\n\t\t\t\t\t\ttype='hidden'\n\t\t\t\t\t\tvalue={state.value}\n\t\t\t\t\t\t{...restProps}\n\t\t\t\t\t/>\n\n\t\t\t\t\t{multiple ? (\n\t\t\t\t\t\thasValue ? (\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclassName={classNames(\"i-input i-select\", {\n\t\t\t\t\t\t\t\t\t\"i-select-multiple\": multiple,\n\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{displayValue({\n\t\t\t\t\t\t\t\t\toptions: formattedOptions,\n\t\t\t\t\t\t\t\t\tvalue: state.value,\n\t\t\t\t\t\t\t\t\tmultiple,\n\t\t\t\t\t\t\t\t\tmaxDisplay,\n\t\t\t\t\t\t\t\t\tonSelect: handleSelect,\n\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tclassName='i-input i-select'\n\t\t\t\t\t\t\t\tplaceholder={placeholder}\n\t\t\t\t\t\t\t\treadOnly\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t)\n\t\t\t\t\t) : null}\n\n\t\t\t\t\t{!multiple && (\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tvalue={active ? state.filterValue : state.value}\n\t\t\t\t\t\t\tclassName='i-input i-select'\n\t\t\t\t\t\t\tplaceholder={state.value || placeholder}\n\t\t\t\t\t\t\tonChange={handleInputChange}\n\t\t\t\t\t\t\treadOnly={!filter}\n\t\t\t\t\t\t/>\n\t\t\t\t\t)}\n\n\t\t\t\t\t<Helpericon\n\t\t\t\t\t\tactive={!hideArrow}\n\t\t\t\t\t\ticon={clearable ? undefined : <UnfoldMoreRound />}\n\t\t\t\t\t\tonClick={handleHelperClick}\n\t\t\t\t\t/>\n\n\t\t\t\t\t{append}\n\t\t\t\t</div>\n\t\t\t</Popup>\n\n\t\t\t{text && <span className='i-input-message'>{text}</span>}\n\t\t</label>\n\t);\n};\n\nexport default Select;\n"],"names":["Select","props","ref","type","name","label","value","placeholder","options","multiple","prepend","append","labelInline","style","className","message","status","hideClear","hideArrow","maxDisplay","border","filter","tip","filterPlaceholder","popupProps","onSelect","onChange","restProps","state","useReactive","inputValue","filterValue","loading","active","setActive","useState","formattedOptions","useMemo","formatOption","filterOptions","fv","filterFn","opt","includes","changeValue","v","handleSelect","option","values","i","findIndex","splice","push","handleFilterChange","debounce","delay","e","target","useEffect","hasValue","length","clearable","text","_jsxs","classNames","children","_jsx","Popup","position","arrow","fitSize","visible","trigger","onVisibleChange","content","Options","onFilter","onClick","displayValue","readOnly","Helpericon","icon","undefined","UnfoldMoreRound","stopPropagation"],"mappings":"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"}