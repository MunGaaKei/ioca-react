{"version":3,"file":"modal.js","sources":["../../../packages/components/modal/modal.tsx"],"sourcesContent":["import classNames from \"classnames\";\nimport { useEffect, useMemo, useRef, useState } from \"react\";\nimport { createPortal } from \"react-dom\";\nimport { useKeydown } from \"../../js/hooks\";\nimport Button from \"../button\";\nimport Helpericon from \"../utils/helpericon\";\nimport \"./index.css\";\nimport { CompositionModal, IModal, IModalContent } from \"./type\";\n\nfunction DefaultContent(props: IModalContent) {\n\tconst {\n\t\ttitle,\n\t\tfooter,\n\t\thideCloseButton,\n\t\tfooterLeft,\n\t\tokButtonProps,\n\t\tcancelButtonProps,\n\t\tchildren,\n\t\tonOk,\n\t\tonClose,\n\t} = props;\n\tconst showHeader = title || !hideCloseButton;\n\n\tconst handleOk = async () => {\n\t\tconst ret = await onOk?.();\n\n\t\tif (ret) return;\n\n\t\tonClose?.();\n\t};\n\n\tconst renderFooter = useMemo(() => {\n\t\tif (footer || footer === null) return footer;\n\n\t\tconst propsOk = Object.assign(\n\t\t\t{\n\t\t\t\tchildren: \"确定\",\n\t\t\t\tonClick: handleOk,\n\t\t\t},\n\t\t\tokButtonProps\n\t\t);\n\t\tconst propsCancel = Object.assign(\n\t\t\t{\n\t\t\t\tsecondary: true,\n\t\t\t\tchildren: \"关闭\",\n\t\t\t\tonClick: onClose,\n\t\t\t},\n\t\t\tcancelButtonProps\n\t\t);\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t{footerLeft}\n\t\t\t\t<Button {...propsOk} />\n\t\t\t\t<Button {...propsCancel} />\n\t\t\t</>\n\t\t);\n\t}, [footer, okButtonProps, cancelButtonProps]);\n\n\treturn (\n\t\t<>\n\t\t\t{showHeader && (\n\t\t\t\t<header className='i-modal-header'>\n\t\t\t\t\t{title && <b>{title}</b>}\n\n\t\t\t\t\t<Helpericon\n\t\t\t\t\t\tactive={!hideCloseButton}\n\t\t\t\t\t\tclassName='i-modal-close'\n\t\t\t\t\t\tonClick={onClose}\n\t\t\t\t\t/>\n\t\t\t\t</header>\n\t\t\t)}\n\n\t\t\t<div className='i-modal-content'>{children}</div>\n\n\t\t\t<footer className='i-modal-footer'>{renderFooter}</footer>\n\t\t</>\n\t);\n}\n\nfunction Modal(props: IModal) {\n\tconst {\n\t\tvisible,\n\t\ttitle,\n\t\tfooter,\n\t\tokButtonProps,\n\t\tcancelButtonProps,\n\t\tclosable = true,\n\t\thideBackdrop,\n\t\tbackdropClosable = true,\n\t\thideCloseButton,\n\t\tdisableEsc,\n\t\twidth,\n\t\theight,\n\t\tcustomized,\n\t\tfixed,\n\t\thideShadow,\n\t\tchildren,\n\t\tstyle,\n\t\tclassName,\n\t\tkeepDOM,\n\t\tfooterLeft,\n\t\tonClick,\n\t\tonVisibleChange,\n\t\tonClose,\n\t\tonOk,\n\t\t...restProps\n\t} = props;\n\tconst [show, setShow] = useState(visible);\n\tconst [active, setActive] = useState(false);\n\tconst [bounced, setBounced] = useState(false);\n\tconst toggable = useRef(true);\n\n\tconst handleShow = () => {\n\t\tif (!toggable.current) return;\n\n\t\t(!keepDOM || !show) && setShow(true);\n\t\ttoggable.current = false;\n\t\tsetTimeout(() => {\n\t\t\tsetActive(true);\n\t\t\tonVisibleChange?.(true);\n\t\t\ttoggable.current = true;\n\t\t}, 24);\n\t};\n\n\tconst handleHide = () => {\n\t\tif (!toggable.current) return;\n\t\ttoggable.current = false;\n\n\t\tif (!closable) {\n\t\t\tsetBounced(true);\n\t\t\tsetTimeout(() => {\n\t\t\t\tsetBounced(false);\n\t\t\t\ttoggable.current = true;\n\t\t\t}, 400);\n\t\t\treturn;\n\t\t}\n\n\t\tsetActive(false);\n\t\tsetTimeout(() => {\n\t\t\t!keepDOM && setShow(false);\n\t\t\ttoggable.current = true;\n\t\t\tonVisibleChange?.(false);\n\t\t\tonClose?.();\n\t\t}, 240);\n\t};\n\n\tconst handleBackdropClick = function () {\n\t\tbackdropClosable && handleHide();\n\t};\n\n\tuseKeydown(\n\t\t(e) => {\n\t\t\tif (e.code !== \"Escape\" || !visible) return;\n\t\t\thandleHide();\n\t\t},\n\t\t{ disabled: disableEsc }\n\t);\n\n\tuseEffect(() => {\n\t\tvisible ? handleShow() : handleHide();\n\t}, [visible]);\n\n\tif (!show) return null;\n\n\treturn createPortal(\n\t\t<div\n\t\t\tclassName={classNames(\n\t\t\t\t\"i-modal-container\",\n\t\t\t\t{\n\t\t\t\t\t\"i-modal-backdrop\": !hideBackdrop,\n\t\t\t\t\t\"i-modal-customized\": customized,\n\t\t\t\t\t\"i-modal-active\": active,\n\t\t\t\t\tfixed,\n\t\t\t\t},\n\t\t\t\tclassName\n\t\t\t)}\n\t\t\tstyle={style}\n\t\t\tonClick={handleBackdropClick}\n\t\t>\n\t\t\t<div\n\t\t\t\tclassName={classNames(\"i-modal\", {\n\t\t\t\t\tbounced,\n\t\t\t\t\tshadow: !hideShadow,\n\t\t\t\t})}\n\t\t\t\tstyle={{\n\t\t\t\t\twidth,\n\t\t\t\t\theight,\n\t\t\t\t}}\n\t\t\t\tonClick={(e) => {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tdocument.documentElement.click();\n\t\t\t\t\tonClick?.(e);\n\t\t\t\t}}\n\t\t\t\t{...restProps}\n\t\t\t>\n\t\t\t\t{customized && children}\n\n\t\t\t\t{!customized && (\n\t\t\t\t\t<DefaultContent\n\t\t\t\t\t\ttitle={title}\n\t\t\t\t\t\thideCloseButton={hideCloseButton}\n\t\t\t\t\t\tfooter={footer}\n\t\t\t\t\t\tokButtonProps={okButtonProps}\n\t\t\t\t\t\tcancelButtonProps={cancelButtonProps}\n\t\t\t\t\t\tchildren={children}\n\t\t\t\t\t\tfooterLeft={footerLeft}\n\t\t\t\t\t\tonOk={onOk}\n\t\t\t\t\t\tonClose={handleHide}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>,\n\t\tdocument.body\n\t);\n}\n\nexport default Modal as CompositionModal;\n"],"names":["DefaultContent","props","title","footer","hideCloseButton","footerLeft","okButtonProps","cancelButtonProps","children","onOk","onClose","showHeader","handleOk","async","renderFooter","useMemo","propsOk","Object","assign","onClick","propsCancel","secondary","_jsxs","_Fragment","_jsx","Button","className","Helpericon","active","Modal","visible","closable","hideBackdrop","backdropClosable","disableEsc","width","height","customized","fixed","hideShadow","style","keepDOM","onVisibleChange","restProps","show","setShow","useState","setActive","bounced","setBounced","toggable","useRef","handleHide","current","setTimeout","useKeydown","e","code","disabled","useEffect","createPortal","classNames","shadow","stopPropagation","document","documentElement","click","body"],"mappings":"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"}