{"version":3,"file":"progress.js","sources":["../../../packages/components/progress/progress.tsx"],"sourcesContent":["import { useReactive } from \"ahooks\";\nimport classNames from \"classnames\";\nimport { useEffect, useMemo, useRef } from \"react\";\nimport \"../../css/input.css\";\nimport { useMouseMove, useMouseUp } from \"../../js/hooks\";\nimport Circle from \"./circle\";\nimport \"./index.css\";\nimport Line from \"./line\";\nimport { IProgress } from \"./type\";\n\nconst Progress = (props: IProgress) => {\n\tconst {\n\t\tvalue = 0,\n\t\tlineWidth = 8,\n\t\tcircleSize = 40,\n\t\tprecision = 0,\n\t\tstyle,\n\t\tdraggable = true,\n\t\ttype = \"line\",\n\t\tbarClass,\n\t\tvertical,\n\t\tlabel,\n\t\tlabelInline,\n\t\tclassName,\n\t\trenderCursor,\n\t\tonChange,\n\t\tonDraggingChange,\n\t} = props;\n\n\tconst ref = useRef<HTMLDivElement>(null);\n\tconst state = useReactive({\n\t\tvalue,\n\t\tdragging: false,\n\t\tsize: 0,\n\t\tstart: 0,\n\t});\n\n\tconst pageXY = vertical ? \"pageY\" : \"pageX\";\n\tconst rectTL = vertical ? \"top\" : \"left\";\n\tconst rectWH = vertical ? \"height\" : \"width\";\n\n\tconst toFixedValue = useMemo(() => {\n\t\tlet value = +state.value.toFixed(precision);\n\t\tvalue = Math.min(100, value);\n\t\tvalue = Math.max(0, value);\n\n\t\treturn value;\n\t}, [state.value, precision]);\n\n\tconst handleMouseDown = (e) => {\n\t\tif (!ref.current || !draggable) return;\n\n\t\tif (e.touches) {\n\t\t\te = e.touches[0];\n\t\t}\n\n\t\tconst rect = ref.current.getBoundingClientRect();\n\t\tconst value = ((e[pageXY] - rect[rectTL]) * 100) / rect[rectWH];\n\n\t\tObject.assign(state, {\n\t\t\tvalue: vertical ? 100 - value : value,\n\t\t\tsize: rect[rectWH],\n\t\t\tstart: rect[rectTL],\n\t\t\tdragging: true,\n\t\t});\n\t\tonDraggingChange?.(true);\n\t};\n\n\tconst handleMouseMove = (e) => {\n\t\tif (!state.dragging || !draggable) return;\n\t\te.preventDefault();\n\n\t\tif (e.touches) {\n\t\t\te = e.touches[0];\n\t\t}\n\n\t\tconst { start, size } = state;\n\t\tconst offset = e[pageXY] - start;\n\n\t\tif (offset < 0 || offset > size) return;\n\n\t\tconst value = ((e[pageXY] - start) * 100) / size;\n\t\tstate.value = vertical ? 100 - value : value;\n\t};\n\n\tconst handleMouseUp = () => {\n\t\tif (!state.dragging || !draggable) return;\n\n\t\tonChange?.(toFixedValue);\n\t\tstate.dragging = false;\n\t\tonDraggingChange?.(false);\n\t};\n\n\tuseMouseMove(handleMouseMove);\n\tuseMouseUp(handleMouseUp);\n\n\tuseEffect(() => {\n\t\tif (value > 100) {\n\t\t\tstate.value = 100;\n\t\t\treturn;\n\t\t}\n\n\t\tif (value < 0) {\n\t\t\tstate.value = 0;\n\t\t\treturn;\n\t\t}\n\n\t\tstate.value = value;\n\t}, [value]);\n\n\treturn (\n\t\t<div\n\t\t\tclassName={classNames(\"i-input-label\", className, {\n\t\t\t\t\"i-input-inline\": labelInline,\n\t\t\t})}\n\t\t\tstyle={style}\n\t\t>\n\t\t\t{label && <span className='i-input-label-text'>{label}</span>}\n\n\t\t\t{type === \"line\" && (\n\t\t\t\t<Line\n\t\t\t\t\tref={ref}\n\t\t\t\t\tvertical={vertical}\n\t\t\t\t\tlineWidth={lineWidth}\n\t\t\t\t\tbarClass={barClass}\n\t\t\t\t\tdragging={state.dragging}\n\t\t\t\t\tvalue={state.value}\n\t\t\t\t\trenderCursor={renderCursor}\n\t\t\t\t\tonMouseDown={handleMouseDown}\n\t\t\t\t\tonTouchStart={handleMouseDown}\n\t\t\t\t/>\n\t\t\t)}\n\n\t\t\t{type === \"circle\" && (\n\t\t\t\t<Circle\n\t\t\t\t\tvalue={state.value}\n\t\t\t\t\tcircleSize={circleSize}\n\t\t\t\t\tlineWidth={lineWidth}\n\t\t\t\t/>\n\t\t\t)}\n\t\t</div>\n\t);\n};\n\nexport default Progress;\n"],"names":["Progress","props","value","lineWidth","circleSize","precision","style","draggable","type","barClass","vertical","label","labelInline","className","renderCursor","onChange","onDraggingChange","ref","useRef","state","useReactive","dragging","size","start","pageXY","rectTL","rectWH","toFixedValue","useMemo","toFixed","Math","min","max","handleMouseDown","e","current","touches","rect","getBoundingClientRect","Object","assign","useMouseMove","preventDefault","offset","useMouseUp","useEffect","_jsxs","classNames","children","_jsx","Line","onMouseDown","onTouchStart","Circle"],"mappings":"iSAUA,MAAMA,EAAYC,IACjB,MAAMC,MACLA,EAAQ,EAACC,UACTA,EAAY,EAACC,WACbA,EAAa,GAAEC,UACfA,EAAY,EAACC,MACbA,EAAKC,UACLA,GAAY,EAAIC,KAChBA,EAAO,OAAMC,SACbA,EAAQC,SACRA,EAAQC,MACRA,EAAKC,YACLA,EAAWC,UACXA,EAASC,aACTA,EAAYC,SACZA,EAAQC,iBACRA,GACGf,EAEEgB,EAAMC,EAAuB,MAC7BC,EAAQC,EAAY,CACzBlB,QACAmB,UAAU,EACVC,KAAM,EACNC,MAAO,IAGFC,EAASd,EAAW,QAAU,QAC9Be,EAASf,EAAW,MAAQ,OAC5BgB,EAAShB,EAAW,SAAW,QAE/BiB,EAAeC,GAAQ,KAC5B,IAAI1B,GAASiB,EAAMjB,MAAM2B,QAAQxB,GAIjC,OAHAH,EAAQ4B,KAAKC,IAAI,IAAK7B,GACtBA,EAAQ4B,KAAKE,IAAI,EAAG9B,GAEbA,CAAK,GACV,CAACiB,EAAMjB,MAAOG,IAEX4B,EAAmBC,IACxB,IAAKjB,EAAIkB,UAAY5B,EAAW,OAE5B2B,EAAEE,UACLF,EAAIA,EAAEE,QAAQ,IAGf,MAAMC,EAAOpB,EAAIkB,QAAQG,wBACnBpC,EAAsC,KAA5BgC,EAAEV,GAAUa,EAAKZ,IAAkBY,EAAKX,GAExDa,OAAOC,OAAOrB,EAAO,CACpBjB,MAAOQ,EAAW,IAAMR,EAAQA,EAChCoB,KAAMe,EAAKX,GACXH,MAAOc,EAAKZ,GACZJ,UAAU,IAEXL,KAAmB,EAAK,EA6CzB,OAjBAyB,GAzByBP,IACxB,IAAKf,EAAME,WAAad,EAAW,OACnC2B,EAAEQ,iBAEER,EAAEE,UACLF,EAAIA,EAAEE,QAAQ,IAGf,MAAMb,MAAEA,EAAKD,KAAEA,GAASH,EAClBwB,EAAST,EAAEV,GAAUD,EAE3B,GAAIoB,EAAS,GAAKA,EAASrB,EAAM,OAEjC,MAAMpB,EAA+B,KAArBgC,EAAEV,GAAUD,GAAgBD,EAC5CH,EAAMjB,MAAQQ,EAAW,IAAMR,EAAQA,CAAK,IAY7C0C,GATsB,KAChBzB,EAAME,UAAad,IAExBQ,IAAWY,GACXR,EAAME,UAAW,EACjBL,KAAmB,GAAM,IAM1B6B,GAAU,KAER1B,EAAMjB,MADHA,EAAQ,IACG,IAIXA,EAAQ,EACG,EAIDA,CAAK,GACjB,CAACA,IAGH4C,SACCjC,UAAWkC,EAAW,gBAAiBlC,EAAW,CACjD,iBAAkBD,IAEnBN,MAAOA,EAEN0C,SAAA,CAAArC,GAASsC,EAAM,OAAA,CAAApC,UAAU,qBAAoBmC,SAAErC,IAEtC,SAATH,GACAyC,EAACC,EACA,CAAAjC,IAAKA,EACLP,SAAUA,EACVP,UAAWA,EACXM,SAAUA,EACVY,SAAUF,EAAME,SAChBnB,MAAOiB,EAAMjB,MACbY,aAAcA,EACdqC,YAAalB,EACbmB,aAAcnB,IAIN,WAATzB,GACAyC,EAACI,EACA,CAAAnD,MAAOiB,EAAMjB,MACbE,WAAYA,EACZD,UAAWA,MAGR"}