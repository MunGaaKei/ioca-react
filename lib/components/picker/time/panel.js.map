{"version":3,"file":"panel.js","sources":["../../../../packages/components/picker/time/panel.tsx"],"sourcesContent":["import { useReactive } from \"ahooks\";\nimport { useEffect, useMemo } from \"react\";\nimport \"./index.css\";\nimport Items from \"./item\";\n\nconst UnitMaps = {\n\th: \"hour\",\n\thh: \"hour\",\n\tm: \"minute\",\n\tmm: \"minute\",\n\ts: \"second\",\n\tss: \"second\",\n};\n\nexport default function Panel(props) {\n\tconst {\n\t\tvalue,\n\t\tstepH = 1,\n\t\tstepM = 1,\n\t\tstepS = 1,\n\t\tformat,\n\t\tperiods,\n\t\trenderItem,\n\t\tonChange,\n\t\tonFallback,\n\t} = props;\n\tconst state = useReactive<any>({\n\t\tperiod: undefined,\n\t\thour: undefined,\n\t\tminute: undefined,\n\t\tsecond: undefined,\n\t});\n\n\tconst [hours, minutes, seconds] = useMemo(() => {\n\t\tconst hasH = format.includes(\"h\");\n\t\tconst hasM = format.includes(\"m\");\n\t\tconst hasS = format.includes(\"s\");\n\t\tconst hours = hasH\n\t\t\t? Array.from(\n\t\t\t\t\t{ length: (periods ? 12 : 24) / stepH },\n\t\t\t\t\t(_, i) => i * stepH\n\t\t\t  )\n\t\t\t: [];\n\t\tconst minutes = hasM\n\t\t\t? Array.from({ length: 60 / stepM }, (_, i) => i * stepM)\n\t\t\t: [];\n\t\tconst seconds = hasS\n\t\t\t? Array.from({ length: 60 / stepS }, (_, i) => i * stepS)\n\t\t\t: [];\n\n\t\treturn [hours, minutes, seconds];\n\t}, [stepH, stepM, stepS, format, periods]);\n\n\tconst updateValue = () => {\n\t\tconst reg = /(hh|h){1}|(mm|m){1}|(ss|s){1}/gi;\n\t\tlet result = format.replace(reg, (pattern) => {\n\t\t\tconst p = pattern.toLowerCase();\n\t\t\tconst u = UnitMaps[p];\n\t\t\tconst n = state[u] ?? 0;\n\n\t\t\treturn p.length > 1 && n < 10 ? `0${n ?? 0}` : n ?? 0;\n\t\t});\n\n\t\tif (periods && hours.length > 0) {\n\t\t\tresult = `${state.period ?? periods[0]} ${result}`;\n\t\t}\n\n\t\tonChange(result);\n\t};\n\n\tconst handleSetTime = (v, unit) => {\n\t\tstate[unit] = v;\n\t\tupdateValue();\n\t};\n\n\tuseEffect(() => {\n\t\tlet time = value ?? \"\";\n\n\t\tif (periods && hours.length > 0 && value) {\n\t\t\tconst [p, t] = value.split(\" \");\n\t\t\ttime = t ?? \"\";\n\t\t\tstate.period = periods.includes(p) ? p : undefined;\n\t\t}\n\n\t\tconst nums = time.match(/\\d+/g) ?? [];\n\n\t\tif (!nums.length) {\n\t\t\tonFallback(\"\");\n\t\t\treturn;\n\t\t}\n\n\t\tlet i = 0;\n\t\tconst r = format.replace(/(hh|h)+|(mm|m)+|(ss|s)+/gi, (p) => {\n\t\t\tconst n = nums[i++] ?? 0;\n\t\t\tlet o = p;\n\n\t\t\tif (UnitMaps[p] === \"hour\") {\n\t\t\t\to = Math.min(periods ? 11 : 23, n);\n\t\t\t}\n\n\t\t\to = Math.min(59, n);\n\n\t\t\tstate[UnitMaps[p]] = o;\n\t\t\treturn p.length > 1 && o < 10 ? `0${o}` : o;\n\t\t});\n\n\t\tonFallback(r);\n\t}, [value]);\n\n\treturn (\n\t\t<div className='i-timepicker'>\n\t\t\t{hours.length > 0 && (\n\t\t\t\t<>\n\t\t\t\t\t{periods && (\n\t\t\t\t\t\t<div className='i-timepicker-list'>\n\t\t\t\t\t\t\t<Items\n\t\t\t\t\t\t\t\titems={periods}\n\t\t\t\t\t\t\t\tactive={state.period}\n\t\t\t\t\t\t\t\tonClick={(p) => handleSetTime(p, \"period\")}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t\t<div className='i-timepicker-list'>\n\t\t\t\t\t\t<Items\n\t\t\t\t\t\t\titems={hours}\n\t\t\t\t\t\t\tactive={state.hour}\n\t\t\t\t\t\t\tunit='hour'\n\t\t\t\t\t\t\trenderItem={renderItem}\n\t\t\t\t\t\t\tonClick={(h) => handleSetTime(h, \"hour\")}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</>\n\t\t\t)}\n\t\t\t{minutes.length > 0 && (\n\t\t\t\t<div className='i-timepicker-list'>\n\t\t\t\t\t<Items\n\t\t\t\t\t\titems={minutes}\n\t\t\t\t\t\tactive={state.minute}\n\t\t\t\t\t\tunit='minute'\n\t\t\t\t\t\trenderItem={renderItem}\n\t\t\t\t\t\tonClick={(m) => handleSetTime(m, \"minute\")}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t)}\n\t\t\t{seconds.length > 0 && (\n\t\t\t\t<div className='i-timepicker-list'>\n\t\t\t\t\t<Items\n\t\t\t\t\t\titems={seconds}\n\t\t\t\t\t\tactive={state.second}\n\t\t\t\t\t\tunit='second'\n\t\t\t\t\t\trenderItem={renderItem}\n\t\t\t\t\t\tonClick={(s) => handleSetTime(s, \"second\")}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n"],"names":["UnitMaps","h","hh","m","mm","s","ss","Panel","props","value","stepH","stepM","stepS","format","periods","renderItem","onChange","onFallback","state","useReactive","period","undefined","hour","minute","second","hours","minutes","seconds","useMemo","hasH","includes","hasM","hasS","Array","from","length","_","i","handleSetTime","v","unit","result","replace","pattern","p","toLowerCase","n","updateValue","useEffect","time","t","split","nums","match","r","o","Math","min","_jsxs","className","children","_jsx","Items","items","active","onClick"],"mappings":"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"}