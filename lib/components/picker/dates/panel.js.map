{"version":3,"file":"panel.js","sources":["../../../../packages/components/picker/dates/panel.tsx"],"sourcesContent":["import {\n\tKeyboardArrowLeftRound,\n\tKeyboardArrowRightRound,\n} from \"@ricons/material\";\nimport { useReactive } from \"ahooks\";\nimport classNames from \"classnames\";\nimport dayjs, { Dayjs } from \"dayjs\";\nimport { throttle } from \"radash\";\nimport { ReactNode, useEffect, useRef } from \"react\";\nimport Icon from \"../../icon\";\nimport Helpericon from \"../../utils/helpericon\";\nimport { IBaseDates } from \"../type\";\nimport Dates from \"./dates\";\n\nconst MONTHS = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12];\n\nconst YearMonth = (\n\tprops: IBaseDates & {\n\t\tonClick?: () => void;\n\t}\n) => {\n\tconst {\n\t\tvalue,\n\t\tunitMonth = \"月\",\n\t\tunitYear = \"年\",\n\t\trenderYear,\n\t\trenderMonth,\n\t\tonClick,\n\t} = props;\n\n\treturn (\n\t\t<a className='i-datepicker-action' data-ripple onClick={onClick}>\n\t\t\t<span>{renderYear?.(value.year())}</span>\n\t\t\t{unitYear}\n\t\t\t<span>{renderMonth?.(value.month() + 1)}</span>\n\t\t\t{unitMonth}\n\t\t</a>\n\t);\n};\n\nconst Panel = (props: IBaseDates) => {\n\tconst {\n\t\tvalue,\n\t\tunitYear,\n\t\tunitMonth,\n\t\trenderDate,\n\t\trenderMonth = (m: ReactNode) => m,\n\t\trenderYear = (y: ReactNode) => y,\n\t\tdisabledDate,\n\t\tonDateClick,\n\t} = props;\n\n\tconst state = useReactive({\n\t\ttoday: value,\n\t\tmonth: value || dayjs(),\n\t\tselectedYear: dayjs(),\n\t\tyears: [] as number[],\n\t\tselectable: false,\n\t});\n\n\tconst $years = useRef<HTMLDivElement>(null);\n\n\tconst handleOperateMonth = (next: boolean) => {\n\t\tstate.month = state.month[next ? \"add\" : \"subtract\"](1, \"month\");\n\t};\n\n\tconst handleChangeDate = (date: Dayjs) => {\n\t\tif (date.isSame(state.today, \"day\")) return;\n\n\t\tif (!date.isSame(state.month, \"month\")) {\n\t\t\tstate.month = date;\n\t\t}\n\n\t\tstate.today = date;\n\t\tonDateClick?.(date);\n\t};\n\n\tconst handleChangeMonth = (month: number) => {\n\t\tstate.month = state.month\n\t\t\t.year(state.selectedYear.year())\n\t\t\t.month(month - 1);\n\t\tstate.selectable = false;\n\t};\n\n\tconst getMoreYears = throttle({ interval: 100 }, (e) => {\n\t\tconst isUp = e.deltaY < 0;\n\n\t\tstate.years = state.years.map((y) => (y += isUp ? -1 : 1));\n\t});\n\n\tuseEffect(() => {\n\t\tif (!state.selectable) return;\n\n\t\tstate.selectedYear = state.month;\n\t\tconst y = state.selectedYear.year();\n\t\tconst years = Array.from({ length: 7 }).map((_, i) => y - 3 + i);\n\n\t\tstate.years = [...years];\n\t}, [state.selectable]);\n\n\tuseEffect(() => {\n\t\tstate.today = value;\n\t\tstate.month = value || dayjs();\n\t}, [value]);\n\n\treturn (\n\t\t<div className='i-datepicker'>\n\t\t\t<div className='i-datepicker-units'>\n\t\t\t\t<YearMonth\n\t\t\t\t\tvalue={state.month}\n\t\t\t\t\tunitYear={unitYear}\n\t\t\t\t\tunitMonth={unitMonth}\n\t\t\t\t\trenderMonth={renderMonth}\n\t\t\t\t\trenderYear={renderYear}\n\t\t\t\t\tonClick={() => (state.selectable = true)}\n\t\t\t\t/>\n\t\t\t\t<a\n\t\t\t\t\tclassName='ml-auto i-datepicker-action'\n\t\t\t\t\tdata-ripple\n\t\t\t\t\tonClick={() => handleOperateMonth(false)}\n\t\t\t\t>\n\t\t\t\t\t<Icon icon={<KeyboardArrowLeftRound />} />\n\t\t\t\t</a>\n\t\t\t\t<a\n\t\t\t\t\tclassName='i-datepicker-action'\n\t\t\t\t\tdata-ripple\n\t\t\t\t\tonClick={() => handleOperateMonth(true)}\n\t\t\t\t>\n\t\t\t\t\t<Icon icon={<KeyboardArrowRightRound />} />\n\t\t\t\t</a>\n\t\t\t</div>\n\n\t\t\t<div\n\t\t\t\tclassName={classNames(\"i-datepicker-ym\", {\n\t\t\t\t\t\"i-datepicker-active\": state.selectable,\n\t\t\t\t})}\n\t\t\t>\n\t\t\t\t<Helpericon\n\t\t\t\t\tactive\n\t\t\t\t\tclassName='i-datepicker-close'\n\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tstate.selectable = false;\n\t\t\t\t\t}}\n\t\t\t\t/>\n\n\t\t\t\t<div\n\t\t\t\t\tref={$years}\n\t\t\t\t\tclassName='i-datepicker-years'\n\t\t\t\t\tonWheel={getMoreYears}\n\t\t\t\t>\n\t\t\t\t\t{state.years.map((y) => (\n\t\t\t\t\t\t<a\n\t\t\t\t\t\t\tkey={y}\n\t\t\t\t\t\t\tclassName={classNames(\"i-datepicker-year\", {\n\t\t\t\t\t\t\t\t\"i-datepicker-active\":\n\t\t\t\t\t\t\t\t\ty === state.selectedYear.year(),\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\t(state.selectedYear =\n\t\t\t\t\t\t\t\t\tstate.selectedYear.year(y))\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{renderYear(y)}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t))}\n\t\t\t\t</div>\n\n\t\t\t\t<div className='i-datepicker-months'>\n\t\t\t\t\t{MONTHS.map((m) => {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\tkey={m}\n\t\t\t\t\t\t\t\tclassName={classNames(\"i-datepicker-month\", {\n\t\t\t\t\t\t\t\t\t\"i-datepicker-active\":\n\t\t\t\t\t\t\t\t\t\tm === state.month.month() + 1,\n\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\tonClick={() => handleChangeMonth(m)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{renderMonth(m)}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t);\n\t\t\t\t\t})}\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<Dates\n\t\t\t\tvalue={state.today}\n\t\t\t\tmonth={state.month}\n\t\t\t\tdisabledDate={disabledDate}\n\t\t\t\tonDateClick={handleChangeDate}\n\t\t\t\trenderDate={renderDate}\n\t\t\t/>\n\t\t</div>\n\t);\n};\n\nexport default Panel;\n"],"names":["MONTHS","YearMonth","props","value","unitMonth","unitYear","renderYear","renderMonth","onClick","_jsxs","className","children","_jsx","year","month","Panel","renderDate","m","y","disabledDate","onDateClick","state","useReactive","today","dayjs","selectedYear","years","selectable","$years","useRef","handleOperateMonth","next","getMoreYears","throttle","interval","e","isUp","deltaY","map","useEffect","Array","from","length","_","i","Icon","icon","KeyboardArrowLeftRound","KeyboardArrowRightRound","classNames","Helpericon","active","stopPropagation","ref","onWheel","handleChangeMonth","Dates","date","isSame"],"mappings":"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"}