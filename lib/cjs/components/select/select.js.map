{"version":3,"file":"select.js","sources":["../../../../packages/components/select/select.tsx"],"sourcesContent":["import { UnfoldMoreRound } from \"@ricons/material\";\r\nimport { useReactive } from \"ahooks\";\r\nimport classNames from \"classnames\";\r\nimport { debounce } from \"radash\";\r\nimport { ChangeEvent, useEffect, useMemo, useState } from \"react\";\r\nimport \"../../css/input.css\";\r\nimport { formatOption } from \"../../js/utils\";\r\nimport { TOption } from \"../../type\";\r\nimport Popup from \"../popup\";\r\nimport Helpericon from \"../utils/helpericon\";\r\nimport \"./index.css\";\r\nimport { Options, displayValue } from \"./options\";\r\nimport { ISelect } from \"./type\";\r\n\r\nconst Select = (props: ISelect) => {\r\n\tconst {\r\n\t\tref,\r\n\t\ttype = \"text\",\r\n\t\tname,\r\n\t\tlabel,\r\n\t\tvalue = \"\",\r\n\t\tplaceholder,\r\n\t\toptions = [],\r\n\t\tmultiple,\r\n\t\tprepend,\r\n\t\tappend,\r\n\t\tlabelInline,\r\n\t\tstyle,\r\n\t\tclassName,\r\n\t\tmessage,\r\n\t\tstatus = \"normal\",\r\n\t\thideClear,\r\n\t\thideArrow,\r\n\t\tmaxDisplay,\r\n\t\tborder,\r\n\t\tfilter,\r\n\t\ttip,\r\n\t\tfilterPlaceholder = \"...\",\r\n\t\tpopupProps,\r\n\t\tonSelect,\r\n\t\tonChange,\r\n\t\t...restProps\r\n\t} = props;\r\n\r\n\tconst state = useReactive({\r\n\t\tinputValue: \"\",\r\n\t\tfilterValue: \"\",\r\n\t\tvalue,\r\n\t\tloading: false,\r\n\t});\r\n\r\n\tconst [active, setActive] = useState<boolean>(false);\r\n\r\n\tconst formattedOptions = useMemo(() => formatOption(options), [options]);\r\n\r\n\tconst filterOptions = useMemo(() => {\r\n\t\tconst { filterValue: fv } = state;\r\n\t\tif (!fv || !filter) return formattedOptions;\r\n\r\n\t\tconst filterFn =\r\n\t\t\ttypeof filter === \"function\"\r\n\t\t\t\t? filter\r\n\t\t\t\t: (opt) => opt.value.includes(fv) || opt.label.includes(fv);\r\n\r\n\t\treturn formattedOptions.filter(filterFn);\r\n\t}, [formattedOptions, filter, state.filterValue]);\r\n\r\n\tconst changeValue = (v: any) => {\r\n\t\tstate.value = v;\r\n\t\tonChange?.(v);\r\n\t};\r\n\r\n\tconst displayLabel = useMemo(() => {\r\n\t\tif (multiple) {\r\n\t\t\treturn \"\";\r\n\t\t}\r\n\r\n\t\tconst option = formattedOptions.find(\r\n\t\t\t(opt) => opt.value === state.value\r\n\t\t);\r\n\t\treturn option ? option.label : state.value;\r\n\t}, [state.value, formattedOptions]);\r\n\r\n\tconst handleSelect = (value: any, option?: TOption) => {\r\n\t\tonSelect?.(value, option);\r\n\r\n\t\tif (multiple) {\r\n\t\t\tconst values = [...(state.value as any[])];\r\n\t\t\tconst i = values.findIndex((v) => v === value);\r\n\r\n\t\t\ti > -1 ? values.splice(i, 1) : values.push(value);\r\n\t\t\tchangeValue(values as any);\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsetActive(false);\r\n\t\tchangeValue(value);\r\n\t};\r\n\r\n\tconst handleVisibleChange = (visible: boolean) => {\r\n\t\tsetActive(visible);\r\n\r\n\t\tif (!filter) return;\r\n\r\n\t\tstate.filterValue = \"\";\r\n\t};\r\n\r\n\tconst handleHelperClick = (e) => {\r\n\t\te.stopPropagation();\r\n\t\tsetActive(true);\r\n\t\tif (!active) return;\r\n\r\n\t\tchangeValue(multiple ? [] : \"\");\r\n\t};\r\n\r\n\tconst handleFilterChange = debounce(\r\n\t\t{ delay: 400 },\r\n\t\t(e: ChangeEvent<HTMLInputElement>) => {\r\n\t\t\tconst v = e.target.value;\r\n\t\t\tstate.filterValue = v;\r\n\t\t}\r\n\t);\r\n\r\n\tconst handleInputChange = (e: ChangeEvent<HTMLInputElement>) => {\r\n\t\tstate.filterValue = e.target.value;\r\n\t};\r\n\r\n\tuseEffect(() => {\r\n\t\tstate.value = value;\r\n\t}, [value]);\r\n\r\n\tconst hasValue = multiple\r\n\t\t? (state.value as any[]).length > 0\r\n\t\t: !!state.value;\r\n\tconst clearable = !hideClear && active && hasValue;\r\n\tconst text = message ?? tip;\r\n\r\n\treturn (\r\n\t\t<label\r\n\t\t\tclassName={classNames(\"i-input-label\", className, {\r\n\t\t\t\t\"i-input-inline\": labelInline,\r\n\t\t\t})}\r\n\t\t\tstyle={style}\r\n\t\t>\r\n\t\t\t{label && <span className='i-input-label-text'>{label}</span>}\r\n\r\n\t\t\t<Popup\r\n\t\t\t\tposition='bottom'\r\n\t\t\t\tarrow={false}\r\n\t\t\t\tfitSize\r\n\t\t\t\toffset={0}\r\n\t\t\t\t{...popupProps}\r\n\t\t\t\tvisible={active}\r\n\t\t\t\ttrigger='none'\r\n\t\t\t\tonVisibleChange={handleVisibleChange}\r\n\t\t\t\tcontent={\r\n\t\t\t\t\t<Options\r\n\t\t\t\t\t\toptions={filterOptions}\r\n\t\t\t\t\t\tvalue={state.value}\r\n\t\t\t\t\t\tmultiple={multiple}\r\n\t\t\t\t\t\tfilter={!!filter}\r\n\t\t\t\t\t\tfilterPlaceholder={filterPlaceholder}\r\n\t\t\t\t\t\tonSelect={handleSelect}\r\n\t\t\t\t\t\tonFilter={handleFilterChange}\r\n\t\t\t\t\t/>\r\n\t\t\t\t}\r\n\t\t\t>\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName={classNames(\"i-input-item\", {\r\n\t\t\t\t\t\t[`i-input-${status}`]: status !== \"normal\",\r\n\t\t\t\t\t\t\"i-input-borderless\": !border,\r\n\t\t\t\t\t\t\"i-input-focus\": active,\r\n\t\t\t\t\t})}\r\n\t\t\t\t\tonClick={() => setActive(true)}\r\n\t\t\t\t>\r\n\t\t\t\t\t{prepend}\r\n\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\tref={ref}\r\n\t\t\t\t\t\ttype='hidden'\r\n\t\t\t\t\t\tvalue={state.value}\r\n\t\t\t\t\t\t{...restProps}\r\n\t\t\t\t\t/>\r\n\r\n\t\t\t\t\t{multiple ? (\r\n\t\t\t\t\t\thasValue ? (\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclassName={classNames(\"i-input i-select\", {\r\n\t\t\t\t\t\t\t\t\t\"i-select-multiple\": multiple,\r\n\t\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t{displayValue({\r\n\t\t\t\t\t\t\t\t\toptions: formattedOptions,\r\n\t\t\t\t\t\t\t\t\tvalue: state.value,\r\n\t\t\t\t\t\t\t\t\tmultiple,\r\n\t\t\t\t\t\t\t\t\tmaxDisplay,\r\n\t\t\t\t\t\t\t\t\tonSelect: handleSelect,\r\n\t\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\tclassName='i-input i-select'\r\n\t\t\t\t\t\t\t\tplaceholder={placeholder}\r\n\t\t\t\t\t\t\t\treadOnly\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t) : null}\r\n\r\n\t\t\t\t\t{!multiple && (\r\n\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\tvalue={active ? state.filterValue : displayLabel}\r\n\t\t\t\t\t\t\tclassName='i-input i-select'\r\n\t\t\t\t\t\t\tplaceholder={displayLabel || placeholder}\r\n\t\t\t\t\t\t\tonChange={handleInputChange}\r\n\t\t\t\t\t\t\treadOnly={!filter}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t<Helpericon\r\n\t\t\t\t\t\tactive={!hideArrow}\r\n\t\t\t\t\t\ticon={clearable ? undefined : <UnfoldMoreRound />}\r\n\t\t\t\t\t\tonClick={handleHelperClick}\r\n\t\t\t\t\t/>\r\n\r\n\t\t\t\t\t{append}\r\n\t\t\t\t</div>\r\n\t\t\t</Popup>\r\n\r\n\t\t\t{text && <span className='i-input-message'>{text}</span>}\r\n\t\t</label>\r\n\t);\r\n};\r\n\r\nexport default Select;\r\n"],"names":["options","useReactive","useState","useMemo","formatOption","debounce","useEffect","_jsxs","classNames","_jsx","Popup","Options","displayValue","Helpericon","UnfoldMoreRound"],"mappings":"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"}