{"version":3,"file":"form.js","sources":["../../../../packages/components/form/form.tsx"],"sourcesContent":["import classNames from \"classnames\";\r\nimport PubSub from \"pubsub-js\";\r\nimport { CSSProperties, useEffect, useMemo } from \"react\";\r\nimport Context from \"./context\";\r\nimport Field from \"./field\";\r\nimport \"./index.css\";\r\nimport { IForm } from \"./type\";\r\nimport useConfig from \"./useConfig\";\r\nimport useForm, { IFormInstance } from \"./useForm\";\r\n\r\nconst Form = (props: IForm) => {\r\n\tconst {\r\n\t\tform = {} as IFormInstance,\r\n\t\trules,\r\n\t\tinitialValues,\r\n\t\tstyle,\r\n\t\tclassName,\r\n\t\twidth,\r\n\t\tcolumns,\r\n\t\titemMaxWidth,\r\n\t\tgap = \"1em\",\r\n\t\tlabelInline,\r\n\t\tlabelWidth,\r\n\t\tlabelRight,\r\n\t\tchildren,\r\n\t\tonKeyDown,\r\n\t\tonEnter,\r\n\t\tonChange,\r\n\t\t...restProps\r\n\t} = props;\r\n\r\n\tconst handleKeyDown = (e) => {\r\n\t\tonKeyDown?.(e);\r\n\r\n\t\tif (e.keyCode !== 13) return;\r\n\r\n\t\tonEnter?.(e, form.data, form);\r\n\t};\r\n\r\n\tconst gridColumns = useMemo(() => {\r\n\t\tif (!columns && !itemMaxWidth) return;\r\n\r\n\t\tif (itemMaxWidth) {\r\n\t\t\treturn `repeat(auto-fill, minmax(${itemMaxWidth}, 1fr))`;\r\n\t\t}\r\n\r\n\t\tif (typeof columns === \"number\") {\r\n\t\t\treturn `minmax(0, 1fr) `.repeat(columns);\r\n\t\t}\r\n\r\n\t\treturn columns;\r\n\t}, [columns]);\r\n\r\n\tuseEffect(() => {\r\n\t\tObject.assign(form, {\r\n\t\t\tdata: { ...initialValues },\r\n\t\t\trules,\r\n\t\t});\r\n\t}, [form]);\r\n\r\n\tuseEffect(() => {\r\n\t\tPubSub.subscribe(`${form.id}:change`, (evt, v) => {\r\n\t\t\tonChange?.(v.name, v.value);\r\n\t\t});\r\n\r\n\t\treturn () => {\r\n\t\t\tPubSub.unsubscribe(`${form.id}:change`);\r\n\t\t};\r\n\t}, []);\r\n\r\n\treturn (\r\n\t\t<Context value={form}>\r\n\t\t\t<form\r\n\t\t\t\tstyle={\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t...style,\r\n\t\t\t\t\t\twidth,\r\n\t\t\t\t\t\tgap,\r\n\t\t\t\t\t\tgridTemplateColumns: gridColumns as any,\r\n\t\t\t\t\t\t\"--label-width\": labelWidth,\r\n\t\t\t\t\t\t\"--label-align\": labelRight ? \"right\" : undefined,\r\n\t\t\t\t\t} as CSSProperties\r\n\t\t\t\t}\r\n\t\t\t\tclassName={classNames(\"i-form\", className, {\r\n\t\t\t\t\t\"i-form-inline\": labelInline,\r\n\t\t\t\t})}\r\n\t\t\t\tonKeyDown={handleKeyDown}\r\n\t\t\t\t{...restProps}\r\n\t\t\t>\r\n\t\t\t\t{children}\r\n\t\t\t</form>\r\n\t\t</Context>\r\n\t);\r\n};\r\n\r\nForm.useForm = useForm;\r\nForm.Field = Field;\r\nForm.useConfig = useConfig;\r\n\r\nexport default Form;\r\n"],"names":["useMemo","useEffect","PubSub","_jsx","Context","classNames","useForm","Field","useConfig"],"mappings":";;;;;;;;;;;;;;;;;;AAUA,MAAM,IAAI,GAAG,CAAC,KAAY,KAAI;AAC7B,IAAA,MAAM,EACL,IAAI,GAAG,EAAmB,EAC1B,KAAK,EACL,aAAa,EACb,KAAK,EACL,SAAS,EACT,KAAK,EACL,OAAO,EACP,YAAY,EACZ,GAAG,GAAG,KAAK,EACX,WAAW,EACX,UAAU,EACV,UAAU,EACV,QAAQ,EACR,SAAS,EACT,OAAO,EACP,QAAQ,EACR,GAAG,SAAS,EACZ,GAAG,KAAK;AAET,IAAA,MAAM,aAAa,GAAG,CAAC,CAAC,KAAI;AAC3B,QAAA,SAAS,GAAG,CAAC,CAAC;AAEd,QAAA,IAAI,CAAC,CAAC,OAAO,KAAK,EAAE;YAAE;QAEtB,OAAO,GAAG,CAAC,EAAE,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC;AAC9B,KAAC;AAED,IAAA,MAAM,WAAW,GAAGA,aAAO,CAAC,MAAK;AAChC,QAAA,IAAI,CAAC,OAAO,IAAI,CAAC,YAAY;YAAE;QAE/B,IAAI,YAAY,EAAE;YACjB,OAAO,CAAA,yBAAA,EAA4B,YAAY,CAAA,OAAA,CAAS;;AAGzD,QAAA,IAAI,OAAO,OAAO,KAAK,QAAQ,EAAE;AAChC,YAAA,OAAO,iBAAiB,CAAC,MAAM,CAAC,OAAO,CAAC;;AAGzC,QAAA,OAAO,OAAO;AACf,KAAC,EAAE,CAAC,OAAO,CAAC,CAAC;IAEbC,eAAS,CAAC,MAAK;AACd,QAAA,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE;AACnB,YAAA,IAAI,EAAE,EAAE,GAAG,aAAa,EAAE;YAC1B,KAAK;AACL,SAAA,CAAC;AACH,KAAC,EAAE,CAAC,IAAI,CAAC,CAAC;IAEVA,eAAS,CAAC,MAAK;AACd,QAAAC,eAAM,CAAC,SAAS,CAAC,CAAA,EAAG,IAAI,CAAC,EAAE,CAAS,OAAA,CAAA,EAAE,CAAC,GAAG,EAAE,CAAC,KAAI;YAChD,QAAQ,GAAG,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC,KAAK,CAAC;AAC5B,SAAC,CAAC;AAEF,QAAA,OAAO,MAAK;YACXA,eAAM,CAAC,WAAW,CAAC,CAAA,EAAG,IAAI,CAAC,EAAE,CAAS,OAAA,CAAA,CAAC;AACxC,SAAC;KACD,EAAE,EAAE,CAAC;IAEN,QACCC,cAAC,CAAAC,eAAO,EAAC,EAAA,KAAK,EAAE,IAAI,EAAA,QAAA,EACnBD,cACC,CAAA,MAAA,EAAA,EAAA,KAAK,EACJ;AACC,gBAAA,GAAG,KAAK;gBACR,KAAK;gBACL,GAAG;AACH,gBAAA,mBAAmB,EAAE,WAAkB;AACvC,gBAAA,eAAe,EAAE,UAAU;gBAC3B,eAAe,EAAE,UAAU,GAAG,OAAO,GAAG,SAAS;AAChC,aAAA,EAEnB,SAAS,EAAEE,mBAAU,CAAC,QAAQ,EAAE,SAAS,EAAE;AAC1C,gBAAA,eAAe,EAAE,WAAW;aAC5B,CAAC,EACF,SAAS,EAAE,aAAa,EAAA,GACpB,SAAS,EAAA,QAAA,EAEZ,QAAQ,EAAA,CACH,EACE,CAAA;AAEZ;AAEA,IAAI,CAAC,OAAO,GAAGC,eAAO;AACtB,IAAI,CAAC,KAAK,GAAGC,aAAK;AAClB,IAAI,CAAC,SAAS,GAAGC,iBAAS;;;;"}