{"version":3,"file":"number.js","sources":["../../../../packages/components/input/number.tsx"],"sourcesContent":["import {\r\n\tKeyboardDoubleArrowUpRound,\r\n\tMinusRound,\r\n\tPlusRound,\r\n} from \"@ricons/material\";\r\nimport { useReactive } from \"ahooks\";\r\nimport classNames from \"classnames\";\r\nimport { ChangeEvent, useEffect } from \"react\";\r\nimport \"../../css/input.css\";\r\nimport { clamp, formatNumber } from \"../../js/utils\";\r\nimport Helpericon from \"../utils/helpericon\";\r\nimport InputContainer from \"./container\";\r\nimport type { IInputNumber } from \"./type\";\r\n\r\nconst Number = (props: IInputNumber) => {\r\n\tconst {\r\n\t\tref,\r\n\t\tlabel,\r\n\t\tname,\r\n\t\tvalue = \"\",\r\n\t\tlabelInline,\r\n\t\tstep = 1,\r\n\t\tmin = -Infinity,\r\n\t\tmax = Infinity,\r\n\t\tthousand,\r\n\t\tprecision,\r\n\t\ttype,\r\n\t\tclassName,\r\n\t\twidth,\r\n\t\tstatus = \"normal\",\r\n\t\tappend,\r\n\t\tborder,\r\n\t\tprepend,\r\n\t\tdisabled,\r\n\t\tmessage,\r\n\t\ttip,\r\n\t\thideControl,\r\n\t\tshowMax,\r\n\t\tstyle,\r\n\t\tonChange,\r\n\t\tonEnter,\r\n\t\tonInput,\r\n\t\tonBlur,\r\n\t\t...restProps\r\n\t} = props;\r\n\r\n\tconst state = useReactive({\r\n\t\tvalue,\r\n\t});\r\n\r\n\tconst getRangeNumber = (v: number) => clamp(v, min, max);\r\n\r\n\tconst getFormatNumber = (v: number) =>\r\n\t\tformatNumber(v, { precision, thousand });\r\n\r\n\tconst formatInputValue = (v?: string | number) => {\r\n\t\tif (!v) return \"\";\r\n\t\tif (typeof v === \"number\") return v.toString();\r\n\t\tif (!thousand) return v;\r\n\r\n\t\treturn v.split(thousand).join(\"\");\r\n\t};\r\n\r\n\tconst handleChange = (e: ChangeEvent<HTMLInputElement>) => {\r\n\t\tconst { value } = e.target;\r\n\t\tconst v = formatInputValue(value.replace(/[^\\d\\.-]/g, \"\")); // 保留负号和小数点\r\n\t\tconst numValue = clamp(+v, min, max); // 确保值在范围内\r\n\r\n\t\tstate.value = getFormatNumber(numValue); // 修复 thousand 格式化\r\n\t\tonChange?.(numValue, e);\r\n\t};\r\n\r\n\tconst handleOperate = (param: number) => {\r\n\t\tconst value = parseFloat(formatInputValue(state.value)) || 0; // 确保值为数字，默认值为 0\r\n\t\tconst result = getRangeNumber(value + param);\r\n\r\n\t\tstate.value = getFormatNumber(result);\r\n\r\n\t\tonChange?.(result);\r\n\t};\r\n\r\n\tconst handleMax = () => {\r\n\t\tconst result = getRangeNumber(max);\r\n\t\tstate.value = getFormatNumber(result);\r\n\t\tonChange?.(result);\r\n\t};\r\n\r\n\tuseEffect(() => {\r\n\t\tstate.value = value;\r\n\t}, [value]);\r\n\r\n\tconst inputProps = {\r\n\t\tref,\r\n\t\tname,\r\n\t\tdisabled,\r\n\t\tvalue: state.value,\r\n\t\tclassName: \"i-input i-input-number\",\r\n\t\tonChange: handleChange,\r\n\t\t...restProps,\r\n\t};\r\n\r\n\treturn (\r\n\t\t<InputContainer\r\n\t\t\tlabel={label}\r\n\t\t\tlabelInline={labelInline}\r\n\t\t\tclassName={className}\r\n\t\t\tstyle={{ width, ...style }}\r\n\t\t\ttip={message ?? tip}\r\n\t\t\tstatus={status}\r\n\t\t>\r\n\t\t\t<div\r\n\t\t\t\tclassName={classNames(\"i-input-item\", {\r\n\t\t\t\t\t[`i-input-${status}`]: status !== \"normal\",\r\n\t\t\t\t\t\"i-input-borderless\": !border,\r\n\t\t\t\t})}\r\n\t\t\t>\r\n\t\t\t\t{prepend && <div className='i-input-prepend'>{prepend}</div>}\r\n\r\n\t\t\t\t{!hideControl && !disabled && (\r\n\t\t\t\t\t<Helpericon\r\n\t\t\t\t\t\tactive\r\n\t\t\t\t\t\ticon={<MinusRound />}\r\n\t\t\t\t\t\tonClick={() => handleOperate(-step)}\r\n\t\t\t\t\t/>\r\n\t\t\t\t)}\r\n\r\n\t\t\t\t<input {...inputProps} />\r\n\r\n\t\t\t\t{!hideControl && !disabled && (\r\n\t\t\t\t\t<Helpericon\r\n\t\t\t\t\t\tactive\r\n\t\t\t\t\t\ticon={<PlusRound />}\r\n\t\t\t\t\t\tonClick={() => handleOperate(step)}\r\n\t\t\t\t\t/>\r\n\t\t\t\t)}\r\n\r\n\t\t\t\t{showMax && max && !disabled && (\r\n\t\t\t\t\t<Helpericon\r\n\t\t\t\t\t\tactive\r\n\t\t\t\t\t\ticon={<KeyboardDoubleArrowUpRound />}\r\n\t\t\t\t\t\tonClick={handleMax}\r\n\t\t\t\t\t/>\r\n\t\t\t\t)}\r\n\r\n\t\t\t\t{append && <div className='i-input-append'>{append}</div>}\r\n\t\t\t</div>\r\n\t\t</InputContainer>\r\n\t);\r\n};\r\n\r\nexport default Number;\r\n"],"names":["useReactive","clamp","formatNumber","useEffect","_jsx","InputContainer","_jsxs","classNames","Helpericon","MinusRound","PlusRound","KeyboardDoubleArrowUpRound"],"mappings":"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"}