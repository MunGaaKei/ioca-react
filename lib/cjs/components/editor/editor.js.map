{"version":3,"file":"editor.js","sources":["../../../../packages/components/editor/editor.tsx"],"sourcesContent":["import classNames from \"classnames\";\r\nimport { useImperativeHandle, useRef } from \"react\";\r\nimport xss from \"xss\";\r\nimport { IButton } from \"../button/type\";\r\nimport getControls, { exec, xssOptions } from \"./controls\";\r\nimport \"./index.css\";\r\nimport { IEditor } from \"./type\";\r\n\r\nconst Editor = (props: IEditor) => {\r\n\tconst {\r\n\t\tref,\r\n\t\twidth,\r\n\t\theight = \"10em\",\r\n\t\tplaceholder,\r\n\t\tautosize,\r\n\t\tborder = true,\r\n\t\trichPaste,\r\n\t\tcontrols = \"simple\",\r\n\t\tclassName,\r\n\t\tstyle,\r\n\t\tonInput,\r\n\t\tonPaste,\r\n\t\tonKeyDown,\r\n\t\t...restProps\r\n\t} = props;\r\n\tconst editorRef = useRef<HTMLDivElement>(null);\r\n\tconst controlBtnProps: IButton = {\r\n\t\tsquare: true,\r\n\t\tflat: true,\r\n\t\tsize: \"small\",\r\n\t};\r\n\r\n\tconst handlePaste = async (e) => {\r\n\t\tonPaste?.(e);\r\n\r\n\t\tif (richPaste) return;\r\n\t\te.preventDefault();\r\n\t\tconst text = e.clipboardData.getData(\"text/plain\");\r\n\t\texec(\"insertText\", false, text);\r\n\t};\r\n\r\n\tconst handleKeyDown = (e) => {\r\n\t\tonKeyDown?.(e);\r\n\r\n\t\tswitch (e.key) {\r\n\t\t\tcase \"Tab\":\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\texec(\"insertHTML\", false, \"&#09;\");\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"Enter\":\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\texec(\"insertLineBreak\");\r\n\r\n\t\t\t\tif (!editorRef.current) return;\r\n\t\t\t\teditorRef.current.scrollBy({\r\n\t\t\t\t\ttop: 20,\r\n\t\t\t\t\tleft: -1000,\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (!autosize) return;\r\n\t\t\t\teditorRef.current.style.height = `${editorRef.current.scrollHeight}px`;\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t};\r\n\r\n\tuseImperativeHandle(ref, () => {\r\n\t\treturn {\r\n\t\t\tinput: editorRef.current,\r\n\t\t\tsetValue(html) {\r\n\t\t\t\tif (!editorRef.current) return;\r\n\t\t\t\tconst safeHtml = xss(html, xssOptions);\r\n\r\n\t\t\t\teditorRef.current.innerHTML = safeHtml;\r\n\t\t\t},\r\n\t\t\tgetSafeValue() {\r\n\t\t\t\tconst html = editorRef.current?.innerHTML ?? \"\";\r\n\r\n\t\t\t\treturn xss(html, xssOptions);\r\n\t\t\t},\r\n\t\t};\r\n\t});\r\n\r\n\tconst handleInput = (e) => {\r\n\t\tlet html = editorRef.current?.innerHTML ?? \"\";\r\n\r\n\t\tif ([\"<br>\", \"\\n\"].includes(html) && editorRef.current) {\r\n\t\t\thtml = \"\";\r\n\t\t\teditorRef.current.innerHTML = html;\r\n\t\t}\r\n\r\n\t\tonInput?.(html, e);\r\n\t};\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={classNames(\"i-editor\", className, {\r\n\t\t\t\t\"i-editor-borderless\": !border,\r\n\t\t\t})}\r\n\t\t\tstyle={{\r\n\t\t\t\t...style,\r\n\t\t\t\t[autosize ? \"minHeight\" : \"height\"]: height,\r\n\t\t\t\twidth,\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t{controls !== \"none\" && (\r\n\t\t\t\t<div className='i-editor-controls'>\r\n\t\t\t\t\t{getControls(controls, {\r\n\t\t\t\t\t\tcontrolBtnProps,\r\n\t\t\t\t\t})}\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\r\n\t\t\t<div\r\n\t\t\t\tref={editorRef}\r\n\t\t\t\tclassName='i-editor-content'\r\n\t\t\t\tdata-placeholder={placeholder}\r\n\t\t\t\tcontentEditable\r\n\t\t\t\tonPaste={handlePaste}\r\n\t\t\t\tonInput={handleInput}\r\n\t\t\t\tonKeyDown={handleKeyDown}\r\n\t\t\t\t{...restProps}\r\n\t\t\t/>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default Editor;\r\n"],"names":["controls","useRef","exec","useImperativeHandle","xss","xssOptions","_jsxs","classNames","_jsx","getControls"],"mappings":"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"}