{"version":3,"file":"modal.js","sources":["../../../../packages/components/modal/modal.tsx"],"sourcesContent":["import classNames from \"classnames\";\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport { createPortal } from \"react-dom\";\r\nimport { useKeydown } from \"../../js/hooks\";\r\nimport Content from \"./content\";\r\nimport ModalContext from \"./context\";\r\nimport \"./index.css\";\r\nimport { CompositionModal, IModal } from \"./type\";\r\nimport useModal from \"./useModal\";\r\n\r\nfunction Modal(props: IModal) {\r\n\tconst {\r\n\t\tvisible,\r\n\t\ttitle,\r\n\t\tfooter,\r\n\t\tokButtonProps,\r\n\t\tcancelButtonProps,\r\n\t\tclosable = true,\r\n\t\thideBackdrop,\r\n\t\tbackdropClosable = true,\r\n\t\thideCloseButton,\r\n\t\tdisableEsc,\r\n\t\twidth,\r\n\t\theight,\r\n\t\tcustomized,\r\n\t\tfixed,\r\n\t\thideShadow,\r\n\t\tchildren,\r\n\t\tstyle,\r\n\t\tclassName,\r\n\t\tkeepDOM,\r\n\t\tfooterLeft,\r\n\t\tonClick,\r\n\t\tonVisibleChange,\r\n\t\tonClose,\r\n\t\tonOk,\r\n\t\t...restProps\r\n\t} = props;\r\n\r\n\tconst [show, setShow] = useState(visible);\r\n\tconst [active, setActive] = useState(false);\r\n\tconst [bounced, setBounced] = useState(false);\r\n\tconst [mounted, setMounted] = useState(false);\r\n\tconst toggable = useRef(true);\r\n\r\n\tconst handleShow = async () => {\r\n\t\tif (!toggable.current) return;\r\n\r\n\t\t(!keepDOM || !show) && setShow(true);\r\n\t\ttoggable.current = false;\r\n\r\n\t\tconst timer = setTimeout(() => {\r\n\t\t\tsetActive(true);\r\n\t\t\tonVisibleChange?.(true);\r\n\t\t\ttoggable.current = true;\r\n\t\t}, 64);\r\n\r\n\t\treturn () => clearTimeout(timer);\r\n\t};\r\n\r\n\tconst handleHide = () => {\r\n\t\tif (!toggable.current) return;\r\n\t\ttoggable.current = false;\r\n\r\n\t\tif (!closable) {\r\n\t\t\tsetBounced(true);\r\n\t\t\tconst timer = setTimeout(() => {\r\n\t\t\t\tsetBounced(false);\r\n\t\t\t\ttoggable.current = true;\r\n\t\t\t}, 400);\r\n\t\t\treturn () => clearTimeout(timer);\r\n\t\t}\r\n\r\n\t\tsetActive(false);\r\n\t\tconst timer = setTimeout(() => {\r\n\t\t\t!keepDOM && setShow(false);\r\n\t\t\ttoggable.current = true;\r\n\t\t\tonVisibleChange?.(false);\r\n\t\t\tonClose?.();\r\n\t\t}, 240);\r\n\r\n\t\treturn () => clearTimeout(timer);\r\n\t};\r\n\r\n\tconst handleBackdropClick = () => {\r\n\t\tbackdropClosable && handleHide();\r\n\t};\r\n\r\n\tuseKeydown(\r\n\t\t(e) => {\r\n\t\t\tif (e.code !== \"Escape\" || !visible) return;\r\n\t\t\thandleHide();\r\n\t\t},\r\n\t\t{ disabled: disableEsc }\r\n\t);\r\n\r\n\tuseEffect(() => {\r\n\t\tvisible ? handleShow() : handleHide();\r\n\t}, [visible]);\r\n\r\n\tuseEffect(() => {\r\n\t\tsetMounted(true);\r\n\t}, []);\r\n\r\n\tconst handleClick = () => {\r\n\t\tif (typeof document === \"undefined\") return;\r\n\t\tdocument.documentElement.click();\r\n\t};\r\n\r\n\tif (!show || !mounted) return null;\r\n\r\n\treturn createPortal(\r\n\t\t<div\r\n\t\t\tclassName={classNames(\r\n\t\t\t\t\"i-modal-container\",\r\n\t\t\t\t{\r\n\t\t\t\t\t\"i-modal-backdrop\": !hideBackdrop,\r\n\t\t\t\t\t\"i-modal-customized\": customized,\r\n\t\t\t\t\t\"i-modal-active\": active,\r\n\t\t\t\t\tfixed,\r\n\t\t\t\t},\r\n\t\t\t\tclassName\r\n\t\t\t)}\r\n\t\t\tstyle={style}\r\n\t\t\tonClick={handleBackdropClick}\r\n\t\t\taria-modal='true'\r\n\t\t\tinert={!active}\r\n\t\t>\r\n\t\t\t<div\r\n\t\t\t\tclassName={classNames(\"i-modal\", {\r\n\t\t\t\t\tbounced,\r\n\t\t\t\t\tshadow: !hideShadow,\r\n\t\t\t\t})}\r\n\t\t\t\tstyle={{\r\n\t\t\t\t\twidth,\r\n\t\t\t\t\theight,\r\n\t\t\t\t}}\r\n\t\t\t\tonClick={(e) => {\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\thandleClick();\r\n\t\t\t\t\tonClick?.(e);\r\n\t\t\t\t}}\r\n\t\t\t\trole='dialog'\r\n\t\t\t\taria-labelledby={title ? \"modal-title\" : undefined}\r\n\t\t\t\t{...restProps}\r\n\t\t\t>\r\n\t\t\t\t<ModalContext.Provider value={true}>\r\n\t\t\t\t\t{customized && children}\r\n\r\n\t\t\t\t\t{!customized && (\r\n\t\t\t\t\t\t<Content\r\n\t\t\t\t\t\t\ttitle={title}\r\n\t\t\t\t\t\t\thideCloseButton={hideCloseButton}\r\n\t\t\t\t\t\t\tfooter={footer}\r\n\t\t\t\t\t\t\tokButtonProps={okButtonProps}\r\n\t\t\t\t\t\t\tcancelButtonProps={cancelButtonProps}\r\n\t\t\t\t\t\t\tchildren={children}\r\n\t\t\t\t\t\t\tfooterLeft={footerLeft}\r\n\t\t\t\t\t\t\tonOk={onOk}\r\n\t\t\t\t\t\t\tonClose={handleHide}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</ModalContext.Provider>\r\n\t\t\t</div>\r\n\t\t</div>,\r\n\t\tdocument?.body ?? null\r\n\t);\r\n}\r\n\r\nModal.useModal = useModal;\r\n\r\nexport default Modal as CompositionModal;\r\n"],"names":["useState","useRef","useKeydown","useEffect","createPortal","_jsx","classNames","_jsxs","ModalContext","Content","useModal"],"mappings":"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"}