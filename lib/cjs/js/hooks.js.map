{"version":3,"file":"hooks.js","sources":["../../../packages/js/hooks.ts"],"sourcesContent":["import { useEffect } from \"react\";\r\n\r\ntype TMouseEvent = (e: MouseEvent) => void;\r\ntype TKeyboardEvent = (e: KeyboardEvent) => void;\r\ntype TEventOption = {\r\n\tdisabled?: boolean;\r\n};\r\n\r\nconst MouseMoveEvents = new Set<TMouseEvent>();\r\nconst MouseUpEvents = new Set<TMouseEvent>();\r\nconst KeydownEvents = new Set<TKeyboardEvent>();\r\n\r\nlet initialized = false;\r\n\r\nconst initEvents = () => {\r\n\tif (!document || initialized) return;\r\n\tinitialized = true;\r\n\r\n\tconst touchable = \"ontouchend\" in document;\r\n\tconst EVENTS: Record<string, any> = {\r\n\t\tMOVE: touchable ? \"touchmove\" : \"mousemove\",\r\n\t\tUP: touchable ? \"touchend\" : \"mouseup\",\r\n\t\tKEYDOWN: \"keydown\",\r\n\t};\r\n\r\n\tdocument.addEventListener(\r\n\t\tEVENTS.MOVE,\r\n\t\t(e) => {\r\n\t\t\tfor (const listener of MouseMoveEvents.values()) {\r\n\t\t\t\tlistener(e);\r\n\t\t\t}\r\n\t\t},\r\n\t\t{ passive: false }\r\n\t);\r\n\r\n\tdocument.addEventListener(EVENTS.UP, (e) => {\r\n\t\tfor (const listener of MouseUpEvents.values()) {\r\n\t\t\tlistener(e);\r\n\t\t}\r\n\t});\r\n\r\n\tdocument.addEventListener(EVENTS.KEYDOWN, (e) => {\r\n\t\tfor (const listener of KeydownEvents.values()) {\r\n\t\t\tlistener(e);\r\n\t\t}\r\n\t});\r\n};\r\n\r\nfunction initEventsOnce() {\r\n\tuseEffect(initEvents, []);\r\n}\r\n\r\nexport function useMouseMove(listener: TMouseEvent, options?: TEventOption) {\r\n\tinitEventsOnce();\r\n\r\n\tuseEffect(() => {\r\n\t\tif (options?.disabled) return;\r\n\r\n\t\tMouseMoveEvents.add(listener);\r\n\t\treturn () => {\r\n\t\t\tMouseMoveEvents.delete(listener);\r\n\t\t};\r\n\t}, []);\r\n}\r\n\r\nexport function useMouseUp(listener: TMouseEvent, options?: TEventOption) {\r\n\tinitEventsOnce();\r\n\r\n\tuseEffect(() => {\r\n\t\tif (options?.disabled) return;\r\n\r\n\t\tMouseUpEvents.add(listener);\r\n\t\treturn () => {\r\n\t\t\tMouseUpEvents.delete(listener);\r\n\t\t};\r\n\t}, []);\r\n}\r\n\r\nexport function useKeydown(listener: TKeyboardEvent, options?: TEventOption) {\r\n\tinitEventsOnce();\r\n\r\n\tuseEffect(() => {\r\n\t\tif (options?.disabled) return;\r\n\r\n\t\tKeydownEvents.add(listener);\r\n\t\treturn () => {\r\n\t\t\tKeydownEvents.delete(listener);\r\n\t\t};\r\n\t}, []);\r\n}\r\n\r\nconst defaultObserver = {\r\n\tobserve: undefined,\r\n\tunobserve: undefined,\r\n\tdisconnect: undefined,\r\n};\r\n\r\nexport function useIntersectionObserver(configs?: IntersectionObserverInit) {\r\n\tif (typeof window === \"undefined\") {\r\n\t\treturn {\r\n\t\t\t...defaultObserver,\r\n\t\t};\r\n\t}\r\n\r\n\tconst WM = new WeakMap();\r\n\tconst IO = new IntersectionObserver((entries) => {\r\n\t\tentries.map((entry) => {\r\n\t\t\tconst callback = WM.get(entry.target);\r\n\t\t\tcallback?.(entry.target, entry.isIntersecting);\r\n\t\t});\r\n\t}, configs);\r\n\r\n\tfunction observe(target: HTMLElement, callback: Function) {\r\n\t\tif (WM.get(target)) return;\r\n\t\tWM.set(target, callback);\r\n\t\ttarget && IO.observe(target);\r\n\t}\r\n\r\n\tfunction unobserve(target: HTMLElement) {\r\n\t\ttarget && IO.unobserve(target);\r\n\t\tWM.delete(target);\r\n\t}\r\n\r\n\tfunction disconnect() {\r\n\t\tIO.disconnect();\r\n\t}\r\n\r\n\treturn {\r\n\t\tobserve,\r\n\t\tunobserve,\r\n\t\tdisconnect,\r\n\t};\r\n}\r\n\r\nexport function useResizeObserver() {\r\n\tif (typeof window === \"undefined\") {\r\n\t\treturn {\r\n\t\t\t...defaultObserver,\r\n\t\t};\r\n\t}\r\n\r\n\tconst WM = new WeakMap();\r\n\tconst IO = new ResizeObserver((entries) => {\r\n\t\tentries.map((entry) => {\r\n\t\t\tconst callback = WM.get(entry.target);\r\n\t\t\tcallback?.(entry.target);\r\n\t\t});\r\n\t});\r\n\r\n\tfunction observe(target: HTMLElement, callback: Function) {\r\n\t\tif (WM.get(target)) return;\r\n\t\ttarget && IO.observe(target);\r\n\t\tWM.set(target, callback);\r\n\t}\r\n\r\n\tfunction unobserve(target: HTMLElement) {\r\n\t\ttarget && IO.unobserve(target);\r\n\t\tWM.delete(target);\r\n\t}\r\n\r\n\tfunction disconnect() {\r\n\t\tIO.disconnect();\r\n\t}\r\n\r\n\treturn {\r\n\t\tobserve,\r\n\t\tunobserve,\r\n\t\tdisconnect,\r\n\t};\r\n}\r\n"],"names":["useEffect"],"mappings":";;;;AAQA,MAAM,eAAe,GAAG,IAAI,GAAG,EAAe;AAC9C,MAAM,aAAa,GAAG,IAAI,GAAG,EAAe;AAC5C,MAAM,aAAa,GAAG,IAAI,GAAG,EAAkB;AAE/C,IAAI,WAAW,GAAG,KAAK;AAEvB,MAAM,UAAU,GAAG,MAAK;IACvB,IAAI,CAAC,QAAQ,IAAI,WAAW;QAAE;IAC9B,WAAW,GAAG,IAAI;AAElB,IAAA,MAAM,SAAS,GAAG,YAAY,IAAI,QAAQ;AAC1C,IAAA,MAAM,MAAM,GAAwB;QACnC,IAAI,EAAE,SAAS,GAAG,WAAW,GAAG,WAAW;QAC3C,EAAE,EAAE,SAAS,GAAG,UAAU,GAAG,SAAS;AACtC,QAAA,OAAO,EAAE,SAAS;KAClB;IAED,QAAQ,CAAC,gBAAgB,CACxB,MAAM,CAAC,IAAI,EACX,CAAC,CAAC,KAAI;QACL,KAAK,MAAM,QAAQ,IAAI,eAAe,CAAC,MAAM,EAAE,EAAE;YAChD,QAAQ,CAAC,CAAC,CAAC;;AAEb,KAAC,EACD,EAAE,OAAO,EAAE,KAAK,EAAE,CAClB;IAED,QAAQ,CAAC,gBAAgB,CAAC,MAAM,CAAC,EAAE,EAAE,CAAC,CAAC,KAAI;QAC1C,KAAK,MAAM,QAAQ,IAAI,aAAa,CAAC,MAAM,EAAE,EAAE;YAC9C,QAAQ,CAAC,CAAC,CAAC;;AAEb,KAAC,CAAC;IAEF,QAAQ,CAAC,gBAAgB,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC,CAAC,KAAI;QAC/C,KAAK,MAAM,QAAQ,IAAI,aAAa,CAAC,MAAM,EAAE,EAAE;YAC9C,QAAQ,CAAC,CAAC,CAAC;;AAEb,KAAC,CAAC;AACH,CAAC;AAED,SAAS,cAAc,GAAA;AACtB,IAAAA,eAAS,CAAC,UAAU,EAAE,EAAE,CAAC;AAC1B;AAEgB,SAAA,YAAY,CAAC,QAAqB,EAAE,OAAsB,EAAA;AACzE,IAAA,cAAc,EAAE;IAEhBA,eAAS,CAAC,MAAK;AAGd,QAAA,eAAe,CAAC,GAAG,CAAC,QAAQ,CAAC;AAC7B,QAAA,OAAO,MAAK;AACX,YAAA,eAAe,CAAC,MAAM,CAAC,QAAQ,CAAC;AACjC,SAAC;KACD,EAAE,EAAE,CAAC;AACP;AAEgB,SAAA,UAAU,CAAC,QAAqB,EAAE,OAAsB,EAAA;AACvE,IAAA,cAAc,EAAE;IAEhBA,eAAS,CAAC,MAAK;AAGd,QAAA,aAAa,CAAC,GAAG,CAAC,QAAQ,CAAC;AAC3B,QAAA,OAAO,MAAK;AACX,YAAA,aAAa,CAAC,MAAM,CAAC,QAAQ,CAAC;AAC/B,SAAC;KACD,EAAE,EAAE,CAAC;AACP;AAEgB,SAAA,UAAU,CAAC,QAAwB,EAAE,OAAsB,EAAA;AAC1E,IAAA,cAAc,EAAE;IAEhBA,eAAS,CAAC,MAAK;QACd,IAAI,OAAO,EAAE,QAAQ;YAAE;AAEvB,QAAA,aAAa,CAAC,GAAG,CAAC,QAAQ,CAAC;AAC3B,QAAA,OAAO,MAAK;AACX,YAAA,aAAa,CAAC,MAAM,CAAC,QAAQ,CAAC;AAC/B,SAAC;KACD,EAAE,EAAE,CAAC;AACP;AAEA,MAAM,eAAe,GAAG;AACvB,IAAA,OAAO,EAAE,SAAS;AAClB,IAAA,SAAS,EAAE,SAAS;AACpB,IAAA,UAAU,EAAE,SAAS;CACrB;AAEK,SAAU,uBAAuB,CAAC,OAAkC,EAAA;AACzE,IAAA,IAAI,OAAO,MAAM,KAAK,WAAW,EAAE;QAClC,OAAO;AACN,YAAA,GAAG,eAAe;SAClB;;AAGF,IAAA,MAAM,EAAE,GAAG,IAAI,OAAO,EAAE;IACxB,MAAM,EAAE,GAAG,IAAI,oBAAoB,CAAC,CAAC,OAAO,KAAI;AAC/C,QAAA,OAAO,CAAC,GAAG,CAAC,CAAC,KAAK,KAAI;YACrB,MAAM,QAAQ,GAAG,EAAE,CAAC,GAAG,CAAC,KAAK,CAAC,MAAM,CAAC;YACrC,QAAQ,GAAG,KAAK,CAAC,MAAM,EAAE,KAAK,CAAC,cAAc,CAAC;AAC/C,SAAC,CAAC;KACF,EAAE,OAAO,CAAC;AAEX,IAAA,SAAS,OAAO,CAAC,MAAmB,EAAE,QAAkB,EAAA;AACvD,QAAA,IAAI,EAAE,CAAC,GAAG,CAAC,MAAM,CAAC;YAAE;AACpB,QAAA,EAAE,CAAC,GAAG,CAAC,MAAM,EAAE,QAAQ,CAAC;AACxB,QAAA,MAAM,IAAI,EAAE,CAAC,OAAO,CAAC,MAAM,CAAC;;IAG7B,SAAS,SAAS,CAAC,MAAmB,EAAA;AACrC,QAAA,MAAM,IAAI,EAAE,CAAC,SAAS,CAAC,MAAM,CAAC;AAC9B,QAAA,EAAE,CAAC,MAAM,CAAC,MAAM,CAAC;;AAGlB,IAAA,SAAS,UAAU,GAAA;QAClB,EAAE,CAAC,UAAU,EAAE;;IAGhB,OAAO;QACN,OAAO;QACP,SAAS;QACT,UAAU;KACV;AACF;SAEgB,iBAAiB,GAAA;AAChC,IAAA,IAAI,OAAO,MAAM,KAAK,WAAW,EAAE;QAClC,OAAO;AACN,YAAA,GAAG,eAAe;SAClB;;AAGF,IAAA,MAAM,EAAE,GAAG,IAAI,OAAO,EAAE;IACxB,MAAM,EAAE,GAAG,IAAI,cAAc,CAAC,CAAC,OAAO,KAAI;AACzC,QAAA,OAAO,CAAC,GAAG,CAAC,CAAC,KAAK,KAAI;YACrB,MAAM,QAAQ,GAAG,EAAE,CAAC,GAAG,CAAC,KAAK,CAAC,MAAM,CAAC;AACrC,YAAA,QAAQ,GAAG,KAAK,CAAC,MAAM,CAAC;AACzB,SAAC,CAAC;AACH,KAAC,CAAC;AAEF,IAAA,SAAS,OAAO,CAAC,MAAmB,EAAE,QAAkB,EAAA;AACvD,QAAA,IAAI,EAAE,CAAC,GAAG,CAAC,MAAM,CAAC;YAAE;AACpB,QAAA,MAAM,IAAI,EAAE,CAAC,OAAO,CAAC,MAAM,CAAC;AAC5B,QAAA,EAAE,CAAC,GAAG,CAAC,MAAM,EAAE,QAAQ,CAAC;;IAGzB,SAAS,SAAS,CAAC,MAAmB,EAAA;AACrC,QAAA,MAAM,IAAI,EAAE,CAAC,SAAS,CAAC,MAAM,CAAC;AAC9B,QAAA,EAAE,CAAC,MAAM,CAAC,MAAM,CAAC;;AAGlB,IAAA,SAAS,UAAU,GAAA;QAClB,EAAE,CAAC,UAAU,EAAE;;IAGhB,OAAO;QACN,OAAO;QACP,SAAS;QACT,UAAU;KACV;AACF;;;;;;;;"}