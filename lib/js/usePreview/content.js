import{jsxs as r,Fragment as t,jsx as e}from"react/jsx-runtime";import"../../components/button/index.js";import n from"../../components/icon/icon.js";import{CloseRound as o,AspectRatioRound as a,OpenInNewRound as i,FileDownloadOutlined as c,RotateRightRound as l,RotateLeftRound as s,KeyboardArrowLeftRound as d,KeyboardArrowRightRound as u}from"@ricons/material";import{useReactive as m}from"ahooks";import p from"classnames";import{throttle as f}from"radash";import{useRef as g,useMemo as h}from"react";import{useMouseMove as k,useMouseUp as j}from"../hooks.js";import{getSuffixByUrl as v,getFileType as C}from"../utils.js";import x from"./renderFile.js";import{TFileType as q}from"./type.js";import b from"../../components/button/button.js";function y(y){const{items:H=[],initial:w=0,renderFile:N=x,onRotate:$,onChange:D,onClose:F,onZoom:Y}=y,M=m({current:w,rotate:0,scale:1,translate:[0,0],start:[0,0],dragging:!1,controlHidden:!0}),T=g(null),X=g([0,0]),_=g(null),A=h((()=>H.map((r=>{const t={src:""};return"string"==typeof r?t.src=r:Object.assign(t,r),t.suffix=v(t.src)||"",t.type=C(t.suffix,r.type),t}))),[H]),{file:E,content:G}=h((()=>{const r=A[M.current];return{file:r,content:N(r)}}),[M.current,H]),I=E.type===q.IMAGE,O=r=>{const t=A.length,{current:e}=M;M.current=r>=t?0:r<0?t-1:r,D?.(M.current,e),M.rotate=A[M.current].rotate||0,1!==M.scale&&(M.scale=1,Y?.(1)),$?.(M.rotate),M.translate=X.current=[0,0]},P=r=>{M.rotate+=r,$?.(M.rotate)},R=f({interval:60},(r=>{if(!I)return;let t=M.scale+(r.deltaY<0?.05:-.05);t>2&&(t=2),t<.25&&(t=.25),Y?.(t),M.scale=t})),W=f({interval:300},(()=>{M.controlHidden&&(M.controlHidden=!1,_.current&&!M.controlHidden&&(clearTimeout(_.current),_.current=null),_.current=setTimeout((()=>{M.controlHidden=!0}),1e3))}));return k((r=>{if(W(),!M.dragging)return;r.preventDefault();const[t,e]=X.current,[n,o]=M.start,a=r.pageX-n,i=r.pageY-o;M.translate=[t+a,e+i]})),j((()=>{M.dragging&&(M.dragging=!1,X.current=M.translate)})),r(t,{children:[e("div",{ref:T,className:p("i-preview-content",{"no-transition":M.dragging}),style:{transform:`translate(${M.translate.map((r=>`${r}px`)).join(",")}) rotate(${M.rotate}deg) scale(${M.scale})`},onWheel:R,onMouseDown:r=>{I&&(r.preventDefault(),M.dragging=!0,M.start=[r.pageX,r.pageY])},onClick:r=>r.stopPropagation(),children:G}),r("div",{className:p("i-preview-controls",{"i-preview-controls-hidden":M.controlHidden}),children:[e(b,{square:!0,flat:!0,onClick:F,children:e(n,{icon:e(o,{})})}),A.length>1&&r("span",{className:"px-8",children:[M.current+1," / ",A.length]}),1!==M.scale&&r(b,{flat:!0,onClick:()=>M.scale=1,children:[e(n,{icon:e(a,{})}),r("span",{className:"mt-2",children:[(100*M.scale).toFixed(0),"%"]})]}),e(b,{square:!0,flat:!0,href:E.src,target:"_blank",children:e(n,{icon:e(i,{})})}),e(b,{square:!0,flat:!0,href:E.src,download:!0,target:"_blank",children:e(n,{icon:e(c,{})})}),e(b,{square:!0,flat:!0,onClick:()=>P(90),children:e(n,{icon:e(l,{})})}),e(b,{square:!0,flat:!0,onClick:()=>P(-90),children:e(n,{icon:e(s,{})})}),A.length>1&&r(t,{children:[e(b,{square:!0,flat:!0,onClick:()=>O(M.current-1),children:e(n,{icon:e(d,{})})}),e(b,{square:!0,flat:!0,onClick:()=>O(M.current+1),children:e(n,{icon:e(u,{})})})]})]})]})}export{y as default};
//# sourceMappingURL=content.js.map
