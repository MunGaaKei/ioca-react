{"version":3,"file":"image.js","sources":["../../../../packages/components/image/image.tsx"],"sourcesContent":["import { HideImageTwotone } from \"@ricons/material\";\r\nimport { useReactive } from \"ahooks\";\r\nimport classNames from \"classnames\";\r\nimport { useEffect, useRef } from \"react\";\r\nimport { useIntersectionObserver } from \"../../js/hooks\";\r\nimport usePreview from \"../../js/usePreview\";\r\nimport Icon from \"../icon\";\r\nimport Loading from \"../loading\";\r\nimport \"./index.css\";\r\nimport List from \"./list\";\r\nimport type { CompositionImage, IImage } from \"./type\";\r\n\r\nconst Image = (props: IImage) => {\r\n\tconst {\r\n\t\tsrc,\r\n\t\tthumb,\r\n\t\tround,\r\n\t\tsize,\r\n\t\theight,\r\n\t\twidth,\r\n\t\tratio,\r\n\t\tinitSize,\r\n\t\tlazyload,\r\n\t\tfallback = (\r\n\t\t\t<Icon icon={<HideImageTwotone />} size='2em' className='color-5' />\r\n\t\t),\r\n\t\tfit,\r\n\t\tstyle,\r\n\t\tclassName,\r\n\t\tcover,\r\n\t\tcoverClass,\r\n\t\tusePreview: previewable,\r\n\t\tonLoad,\r\n\t\tonError,\r\n\t\tonClick,\r\n\t\t...restProps\r\n\t} = props;\r\n\r\n\tconst state = useReactive<{ status?: string }>({\r\n\t\tstatus: \"loading\",\r\n\t});\r\n\tconst ref = useRef<HTMLImageElement>(null);\r\n\r\n\tconst { observe, unobserve } = useIntersectionObserver();\r\n\tconst preview = usePreview();\r\n\r\n\tconst handleError = (err) => {\r\n\t\tonError?.(err);\r\n\t\tstate.status = \"error\";\r\n\t};\r\n\r\n\tconst handleLoad = (e) => {\r\n\t\tonLoad?.(e);\r\n\t\tstate.status = undefined;\r\n\t};\r\n\r\n\tconst handleClick = (e) => {\r\n\t\tonClick?.(e);\r\n\r\n\t\tif (!previewable || !src) return;\r\n\r\n\t\tconst previewConfigs =\r\n\t\t\ttypeof previewable === \"boolean\" ? {} : previewable;\r\n\r\n\t\tpreview({\r\n\t\t\t...previewConfigs,\r\n\t\t\titems: [\r\n\t\t\t\t{\r\n\t\t\t\t\tsrc,\r\n\t\t\t\t\ttype: \"IMAGE\",\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t});\r\n\t};\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!src || typeof window === \"undefined\") return;\r\n\r\n\t\tif (!ref.current?.complete && observe && lazyload) {\r\n\t\t\tstate.status = \"loading\";\r\n\t\t}\r\n\r\n\t\tif (!lazyload || !ref.current || !observe) return;\r\n\r\n\t\tobserve(ref.current, (tar: HTMLElement, visible: boolean) => {\r\n\t\t\tif (!visible) return;\r\n\r\n\t\t\ttar.setAttribute(\"src\", tar.dataset.src || \"\");\r\n\t\t\tunobserve(tar);\r\n\t\t});\r\n\r\n\t\treturn () => {\r\n\t\t\tref.current && unobserve(ref.current);\r\n\t\t};\r\n\t}, [src]);\r\n\r\n\trestProps[lazyload ? \"data-src\" : \"src\"] = thumb ?? src;\r\n\tconst iSize = state.status === \"loading\" ? initSize : undefined;\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tstyle={{\r\n\t\t\t\twidth: width ?? size ?? iSize,\r\n\t\t\t\theight: height ?? size ?? iSize,\r\n\t\t\t\taspectRatio: ratio,\r\n\t\t\t\t...style,\r\n\t\t\t}}\r\n\t\t\tclassName={classNames(\"i-image\", className, {\r\n\t\t\t\trounded: round,\r\n\t\t\t\t[`i-image-${state.status}`]: state.status,\r\n\t\t\t})}\r\n\t\t\tonClick={handleClick}\r\n\t\t>\r\n\t\t\t{state.status === \"error\" ? (\r\n\t\t\t\tfallback\r\n\t\t\t) : (\r\n\t\t\t\t<>\r\n\t\t\t\t\t{src && (\r\n\t\t\t\t\t\t<img\r\n\t\t\t\t\t\t\tref={ref}\r\n\t\t\t\t\t\t\tstyle={{ objectFit: fit }}\r\n\t\t\t\t\t\t\t{...restProps}\r\n\t\t\t\t\t\t\tonLoad={handleLoad}\r\n\t\t\t\t\t\t\tonError={handleError}\r\n\t\t\t\t\t\t\tonClick={handleClick}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t{src && state.status === \"loading\" && <Loading absolute />}\r\n\r\n\t\t\t\t\t{cover && (\r\n\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\tclassName={classNames(\"i-image-cover\", coverClass)}\r\n\t\t\t\t\t\t\tonClick={handleClick}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{cover}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</>\r\n\t\t\t)}\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nImage.List = List;\r\n\r\nexport default Image as CompositionImage;\r\n"],"names":["_jsx","_jsxs","_Fragment"],"mappings":"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"}