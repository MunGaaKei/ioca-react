{"version":3,"file":"panel.js","sources":["../../../../../packages/components/picker/time/panel.tsx"],"sourcesContent":["import { useReactive } from \"ahooks\";\r\nimport { useEffect, useMemo } from \"react\";\r\nimport \"./index.css\";\r\nimport Items from \"./item\";\r\n\r\nconst UnitMaps = {\r\n\th: \"hour\",\r\n\thh: \"hour\",\r\n\tm: \"minute\",\r\n\tmm: \"minute\",\r\n\ts: \"second\",\r\n\tss: \"second\",\r\n};\r\n\r\nexport default function Panel(props) {\r\n\tconst {\r\n\t\tvalue,\r\n\t\tstepH = 1,\r\n\t\tstepM = 1,\r\n\t\tstepS = 1,\r\n\t\tformat,\r\n\t\tperiods,\r\n\t\trenderItem,\r\n\t\tonChange,\r\n\t\tonFallback,\r\n\t} = props;\r\n\tconst state = useReactive<any>({\r\n\t\tperiod: undefined,\r\n\t\thour: undefined,\r\n\t\tminute: undefined,\r\n\t\tsecond: undefined,\r\n\t});\r\n\r\n\tconst [hours, minutes, seconds] = useMemo(() => {\r\n\t\tconst hasH = format.includes(\"h\");\r\n\t\tconst hasM = format.includes(\"m\");\r\n\t\tconst hasS = format.includes(\"s\");\r\n\t\tconst hours = hasH\r\n\t\t\t? Array.from(\r\n\t\t\t\t\t{ length: (periods ? 12 : 24) / stepH },\r\n\t\t\t\t\t(_, i) => i * stepH\r\n\t\t\t  )\r\n\t\t\t: [];\r\n\t\tconst minutes = hasM\r\n\t\t\t? Array.from({ length: 60 / stepM }, (_, i) => i * stepM)\r\n\t\t\t: [];\r\n\t\tconst seconds = hasS\r\n\t\t\t? Array.from({ length: 60 / stepS }, (_, i) => i * stepS)\r\n\t\t\t: [];\r\n\r\n\t\treturn [hours, minutes, seconds];\r\n\t}, [stepH, stepM, stepS, format, periods]);\r\n\r\n\tconst updateValue = () => {\r\n\t\tconst reg = /(hh|h){1}|(mm|m){1}|(ss|s){1}/gi;\r\n\t\tlet result = format.replace(reg, (pattern) => {\r\n\t\t\tconst p = pattern.toLowerCase();\r\n\t\t\tconst u = UnitMaps[p];\r\n\t\t\tconst n = state[u] ?? 0;\r\n\r\n\t\t\treturn p.length > 1 && n < 10 ? `0${n ?? 0}` : n ?? 0;\r\n\t\t});\r\n\r\n\t\tif (periods && hours.length > 0) {\r\n\t\t\tresult = `${state.period ?? periods[0]} ${result}`;\r\n\t\t}\r\n\r\n\t\tonChange(result);\r\n\t};\r\n\r\n\tconst handleSetTime = (v, unit) => {\r\n\t\tstate[unit] = v;\r\n\t\tupdateValue();\r\n\t};\r\n\r\n\tuseEffect(() => {\r\n\t\tlet time = value ?? \"\";\r\n\r\n\t\tif (periods && hours.length > 0 && value) {\r\n\t\t\tconst [p, t] = value.split(\" \");\r\n\t\t\ttime = t ?? \"\";\r\n\t\t\tstate.period = periods.includes(p) ? p : undefined;\r\n\t\t}\r\n\r\n\t\tconst nums = time.match(/\\d+/g) ?? [];\r\n\r\n\t\tif (!nums.length) {\r\n\t\t\tonFallback(\"\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet i = 0;\r\n\t\tconst r = format.replace(/(hh|h)+|(mm|m)+|(ss|s)+/gi, (p) => {\r\n\t\t\tconst n = nums[i++] ?? 0;\r\n\t\t\tlet o = p;\r\n\r\n\t\t\tif (UnitMaps[p] === \"hour\") {\r\n\t\t\t\to = Math.min(periods ? 11 : 23, n);\r\n\t\t\t}\r\n\r\n\t\t\to = Math.min(59, n);\r\n\r\n\t\t\tstate[UnitMaps[p]] = o;\r\n\t\t\treturn p.length > 1 && o < 10 ? `0${o}` : o;\r\n\t\t});\r\n\r\n\t\tonFallback(r);\r\n\t}, [value]);\r\n\r\n\treturn (\r\n\t\t<div className='i-timepicker'>\r\n\t\t\t{hours.length > 0 && (\r\n\t\t\t\t<>\r\n\t\t\t\t\t{periods && (\r\n\t\t\t\t\t\t<div className='i-timepicker-list'>\r\n\t\t\t\t\t\t\t<Items\r\n\t\t\t\t\t\t\t\titems={periods}\r\n\t\t\t\t\t\t\t\tactive={state.period}\r\n\t\t\t\t\t\t\t\tonClick={(p) => handleSetTime(p, \"period\")}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t)}\r\n\t\t\t\t\t<div className='i-timepicker-list'>\r\n\t\t\t\t\t\t<Items\r\n\t\t\t\t\t\t\titems={hours}\r\n\t\t\t\t\t\t\tactive={state.hour}\r\n\t\t\t\t\t\t\tunit='hour'\r\n\t\t\t\t\t\t\trenderItem={renderItem}\r\n\t\t\t\t\t\t\tonClick={(h) => handleSetTime(h, \"hour\")}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</>\r\n\t\t\t)}\r\n\t\t\t{minutes.length > 0 && (\r\n\t\t\t\t<div className='i-timepicker-list'>\r\n\t\t\t\t\t<Items\r\n\t\t\t\t\t\titems={minutes}\r\n\t\t\t\t\t\tactive={state.minute}\r\n\t\t\t\t\t\tunit='minute'\r\n\t\t\t\t\t\trenderItem={renderItem}\r\n\t\t\t\t\t\tonClick={(m) => handleSetTime(m, \"minute\")}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\t\t\t{seconds.length > 0 && (\r\n\t\t\t\t<div className='i-timepicker-list'>\r\n\t\t\t\t\t<Items\r\n\t\t\t\t\t\titems={seconds}\r\n\t\t\t\t\t\tactive={state.second}\r\n\t\t\t\t\t\tunit='second'\r\n\t\t\t\t\t\trenderItem={renderItem}\r\n\t\t\t\t\t\tonClick={(s) => handleSetTime(s, \"second\")}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\t\t</div>\r\n\t);\r\n}\r\n"],"names":["_jsxs","_jsx"],"mappings":"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"}