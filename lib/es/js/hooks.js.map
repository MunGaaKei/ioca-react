{"version":3,"file":"hooks.js","sources":["../../../packages/js/hooks.ts"],"sourcesContent":["import { useEffect, useRef } from \"react\";\n\ntype TMouseEvent = (e: MouseEvent) => void;\ntype TKeyboardEvent = (e: KeyboardEvent) => void;\ntype TEventOption = {\n\tdisabled?: boolean;\n};\n\nconst isBrowser = typeof window !== \"undefined\";\n\nlet ClickEvents: Set<TMouseEvent>;\nlet MouseMoveEvents: Set<TMouseEvent>;\nlet MouseUpEvents: Set<TMouseEvent>;\nlet KeydownEvents: Set<TKeyboardEvent>;\nlet touchable: boolean;\nlet EVENTS: any;\n\nif (isBrowser) {\n\tClickEvents = new Set<TMouseEvent>();\n\tMouseMoveEvents = new Set<TMouseEvent>();\n\tMouseUpEvents = new Set<TMouseEvent>();\n\tKeydownEvents = new Set<TKeyboardEvent>();\n\ttouchable = \"ontouchend\" in document;\n\tEVENTS = {\n\t\tMOVE: touchable ? \"touchmove\" : \"mousemove\",\n\t\tUP: touchable ? \"touchend\" : \"mouseup\",\n\t\tKEYDOWN: \"keydown\",\n\t};\n\n\tdocument.addEventListener(\n\t\tEVENTS.MOVE,\n\t\t(e: MouseEvent) => {\n\t\t\tfor (const listener of MouseMoveEvents.values()) {\n\t\t\t\tlistener(e);\n\t\t\t}\n\t\t},\n\t\t{ passive: false }\n\t);\n\n\tdocument.addEventListener(EVENTS.UP, (e) => {\n\t\tfor (const listener of MouseUpEvents.values()) {\n\t\t\tlistener(e);\n\t\t}\n\t});\n\n\tdocument.addEventListener(EVENTS.KEYDOWN, (e) => {\n\t\tfor (const listener of KeydownEvents.values()) {\n\t\t\tlistener(e);\n\t\t}\n\t});\n}\n\nexport function useMouseMove(listener: TMouseEvent, options?: TEventOption) {\n\tuseEffect(() => {\n\t\tif (!isBrowser || options?.disabled) return;\n\n\t\tMouseMoveEvents.add(listener);\n\t\treturn () => {\n\t\t\tMouseMoveEvents.delete(listener);\n\t\t};\n\t}, [listener]);\n}\n\nexport function useMouseUp(listener: TMouseEvent, options?: TEventOption) {\n\tuseEffect(() => {\n\t\tif (!isBrowser || options?.disabled) return;\n\n\t\tMouseUpEvents.add(listener);\n\t\treturn () => {\n\t\t\tMouseUpEvents.delete(listener);\n\t\t};\n\t}, [listener]);\n}\n\nexport function useKeydown(listener: TKeyboardEvent, options?: TEventOption) {\n\tuseEffect(() => {\n\t\tif (!isBrowser || options?.disabled) return;\n\n\t\tKeydownEvents.add(listener);\n\t\treturn () => {\n\t\t\tKeydownEvents.delete(listener);\n\t\t};\n\t}, [listener]);\n}\n\nexport function useIntersectionObserver(configs?: IntersectionObserverInit) {\n\tconst WM = useRef(new WeakMap());\n\tconst IO = useRef<IntersectionObserver | null>(null);\n\n\tuseEffect(() => {\n\t\tif (!isBrowser) return;\n\n\t\tIO.current = new IntersectionObserver((entries) => {\n\t\t\tentries.map((entry) => {\n\t\t\t\tconst callback = WM.current.get(entry.target);\n\t\t\t\tcallback?.(entry.target, entry.isIntersecting);\n\t\t\t});\n\t\t}, configs);\n\n\t\treturn () => {\n\t\t\tIO.current?.disconnect();\n\t\t};\n\t}, []);\n\n\tfunction observe(target: HTMLElement, callback: Function) {\n\t\tif (!isBrowser || !IO.current || !target) return;\n\t\tif (WM.current.get(target)) return;\n\n\t\tWM.current.set(target, callback);\n\t\tIO.current.observe(target);\n\t}\n\n\tfunction unobserve(target: HTMLElement) {\n\t\tif (!isBrowser || !IO.current || !target) return;\n\t\tIO.current.unobserve(target);\n\t\tWM.current.delete(target);\n\t}\n\n\tfunction disconnect() {\n\t\tif (!isBrowser || !IO.current) return;\n\t\tIO.current.disconnect();\n\t}\n\n\treturn {\n\t\tobserve,\n\t\tunobserve,\n\t\tdisconnect,\n\t};\n}\n\nexport function useResizeObserver() {\n\tconst WM = useRef(new WeakMap());\n\tconst IO = useRef<ResizeObserver | null>(null);\n\n\tuseEffect(() => {\n\t\tif (!isBrowser) return;\n\n\t\tIO.current = new ResizeObserver((entries) => {\n\t\t\tentries.map((entry) => {\n\t\t\t\tconst callback = WM.current.get(entry.target);\n\t\t\t\tcallback?.(entry.target);\n\t\t\t});\n\t\t});\n\n\t\treturn () => {\n\t\t\tIO.current?.disconnect();\n\t\t};\n\t}, []);\n\n\tfunction observe(target: HTMLElement, callback: Function) {\n\t\tif (!isBrowser || !IO.current || !target) return;\n\t\tif (WM.current.get(target)) return;\n\n\t\tIO.current.observe(target);\n\t\tWM.current.set(target, callback);\n\t}\n\n\tfunction unobserve(target: HTMLElement) {\n\t\tif (!isBrowser || !IO.current || !target) return;\n\t\tIO.current.unobserve(target);\n\t\tWM.current.delete(target);\n\t}\n\n\tfunction disconnect() {\n\t\tif (!isBrowser || !IO.current) return;\n\t\tIO.current.disconnect();\n\t}\n\n\treturn {\n\t\tobserve,\n\t\tunobserve,\n\t\tdisconnect,\n\t};\n}\n"],"names":[],"mappings":"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"}